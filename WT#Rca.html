<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<!-- Google Fonts: DM Sans + IBM Plex Mono -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@300;400;500;600&family=IBM+Plex+Mono:wght@400;500&display=swap" rel="stylesheet">
<title>WT*Rca™</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=DM+Sans:wght@300;400;500;600&family=IBM+Plex+Mono:wght@400;500&display=swap');
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0;}
:root{
  --ink:#1a1825;--paper:#f5f2ed;--mid:#e8e4de;--dim:#b0a898;
  --accent:#d63031;--green:#00b894;--blue:#0984e3;--yellow:#fdcb6e;
  --mono:'IBM Plex Mono',monospace;--sans:'DM Sans',sans-serif;
}
body{font-family:var(--sans);background:var(--paper);min-height:100vh;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:28px;padding:40px 20px;}
/* page chrome */
.page-label{font-family:var(--mono);font-size:10px;letter-spacing:3px;color:var(--dim);text-transform:uppercase;}
.demo-card{background:white;border:1px solid var(--mid);border-radius:3px;padding:36px;max-width:420px;width:100%;box-shadow:0 2px 12px rgba(0,0,0,0.06);}
.demo-card h2{font-size:20px;font-weight:600;color:var(--ink);margin-bottom:4px;}
.demo-card .sub{font-size:13px;color:var(--dim);margin-bottom:24px;}
.field{margin-bottom:14px;}
.field label{display:block;font-size:12px;font-weight:500;color:#555;margin-bottom:5px;}
.field input{width:100%;padding:9px 12px;border:1px solid var(--mid);border-radius:2px;font-family:var(--sans);font-size:14px;outline:none;color:var(--ink);transition:border-color 0.15s;}
.field input:focus{border-color:var(--ink);}
.field input[readonly]{background:var(--paper);color:var(--dim);cursor:not-allowed;}
.field .field-hint{font-family:var(--mono);font-size:9px;color:var(--dim);margin-top:4px;letter-spacing:0.5px;}
.submit{width:100%;padding:11px;background:var(--ink);color:white;border:none;border-radius:2px;font-family:var(--sans);font-size:14px;font-weight:500;cursor:pointer;margin-top:6px;transition:opacity 0.2s;}
.submit:disabled{opacity:0.35;cursor:not-allowed;}
.submit:not(:disabled):hover{background:#2d2a3e;}
/* widget */
.ecw{display:flex;align-items:center;gap:14px;border:1px solid #d8d4ce;border-radius:2px;padding:12px 16px;margin-bottom:14px;cursor:pointer;user-select:none;transition:border-color 0.2s,box-shadow 0.2s,transform 0.1s;background:white;min-height:58px;}
.ecw:hover{border-color:#888;box-shadow:0 2px 8px rgba(0,0,0,0.08);}
.ecw:active{transform:scale(0.99);}
.ecw-box{width:24px;height:24px;flex-shrink:0;border:1.5px solid #bbb;border-radius:2px;display:flex;align-items:center;justify-content:center;transition:all 0.2s;background:white;position:relative;}
.ecw-box .spin{width:15px;height:15px;border:2px solid #ddd;border-top-color:var(--ink);border-radius:50%;opacity:0;animation:wSpin 0.6s linear infinite;}
@keyframes wSpin{to{transform:rotate(360deg);}}
.ecw.loading .ecw-box .spin{opacity:1;}
.ecw.ok .ecw-box{border-color:var(--green);background:#f0fdf9;}
.ecw.ok .ecw-box svg{opacity:1;transform:scale(1);}
.ecw-box svg{opacity:0;transform:scale(0);transition:all 0.25s cubic-bezier(0.175,0.885,0.32,1.6);}
.ecw-text{flex:1;}
.ecw-text .main{font-size:14px;color:var(--ink);}
.ecw-text .sub2{font-family:var(--mono);font-size:9px;color:var(--dim);margin-top:2px;letter-spacing:0.5px;}
.ecw-badge{display:flex;flex-direction:column;align-items:center;gap:2px;flex-shrink:0;}
.ecw-badge-icon{width:28px;height:28px;background:var(--ink);border-radius:3px;display:flex;align-items:center;justify-content:center;}
.ecw-badge-label{font-family:var(--mono);font-size:7px;color:var(--dim);}
/* overlay */
.eco{position:fixed;inset:0;background:rgba(15,12,25,0.75);z-index:9999;display:flex;align-items:center;justify-content:center;opacity:0;pointer-events:none;transition:opacity 0.2s;backdrop-filter:blur(6px);}
.eco.open{opacity:1;pointer-events:all;}
/* modal */
.ecm{width:540px;max-width:96vw;max-height:92vh;background:white;border:1px solid var(--mid);border-radius:3px;display:flex;flex-direction:column;transform:translateY(20px) scale(0.97);opacity:0;transition:transform 0.28s cubic-bezier(0.175,0.885,0.32,1.15),opacity 0.22s ease;overflow:hidden;box-shadow:0 24px 80px rgba(0,0,0,0.25);}
.eco.open .ecm{transform:translateY(0) scale(1);opacity:1;}
.ecm-head{padding:14px 18px 12px;border-bottom:1px solid var(--mid);display:flex;align-items:center;justify-content:space-between;flex-shrink:0;background:var(--paper);}
.ecm-title h3{font-family:var(--mono);font-size:9px;letter-spacing:3px;color:var(--accent);font-weight:500;}
.ecm-title p{font-size:15px;font-weight:600;color:var(--ink);margin-top:2px;}
.ecm-meta{display:flex;align-items:center;gap:10px;}
.ecm-timer{font-family:var(--mono);font-size:22px;color:var(--ink);min-width:34px;text-align:right;}
.ecm-timer{transition:color 0.3s;}
.ecm-timer.hot{color:var(--accent);animation:tBlink 0.45s infinite,tShake 0.45s infinite;}
@keyframes tBlink{50%{opacity:0.25;}}
@keyframes failFlash{0%,100%{background:var(--paper)}20%{background:#fff0f0}60%{background:#ffe0e0}}
@keyframes tShake{0%,100%{transform:translateX(0)}25%{transform:translateX(-2px)}75%{transform:translateX(2px)}}
@keyframes timerTick{0%{transform:scale(1.2)}100%{transform:scale(1)}}
.dot{transition:background 0.3s,transform 0.3s;}
.ecm-close{background:none;border:none;cursor:pointer;color:var(--dim);font-size:18px;line-height:1;padding:4px 6px;transition:color 0.15s;}
.ecm-close:hover{color:var(--accent);}
.ecm-dots{display:flex;gap:3px;padding:8px 18px;border-bottom:1px solid var(--mid);flex-wrap:wrap;background:white;}
.dot{width:7px;height:7px;border-radius:50%;background:var(--mid);transition:all 0.3s cubic-bezier(0.175,0.885,0.32,1.4);}
.dot.done{background:var(--green);animation:dotDone 0.35s cubic-bezier(0.175,0.885,0.32,1.4);}
@keyframes dotDone{0%{transform:scale(0.5)}60%{transform:scale(1.4)}100%{transform:scale(1)}}
.dot.now{background:var(--accent);transform:scale(1.5);animation:dotPulse 1.2s ease-in-out infinite;}
@keyframes dotPulse{0%,100%{box-shadow:0 0 0 0 rgba(214,48,49,0.4)}50%{box-shadow:0 0 0 5px rgba(214,48,49,0)}}
.ecm-body{padding:18px;flex:1;overflow-y:auto;}
.ecm-body::-webkit-scrollbar{width:3px;}
.ecm-body::-webkit-scrollbar-thumb{background:var(--mid);}
/* status */
.ec-status{display:none;font-family:var(--mono);font-size:10px;padding:7px 10px;margin-bottom:12px;letter-spacing:0.5px;border-radius:1px;}
.ec-status.err,.ec-status.warn,.ec-status.ok{animation:statusSlide 0.25s ease;}
@keyframes statusSlide{from{opacity:0;transform:translateX(-8px)}to{opacity:1;transform:none}}
.ec-status.err{display:block;background:#fff5f5;border-left:3px solid var(--accent);color:var(--accent);}
.ec-status.warn{display:block;background:#fffbf0;border-left:3px solid var(--yellow);color:#a07c00;}
.ec-status.ok{display:block;background:#f0fdf9;border-left:3px solid var(--green);color:var(--green);}
/* challenge base */
.ec-ch{display:none;}
.ec-ch.active{display:block;}
@keyframes chSlide{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:none}}
.ec-q{font-size:13px;color:#444;margin-bottom:12px;line-height:1.7;}
.ec-q strong{color:var(--ink);font-weight:600;}
.ec-in{width:100%;background:var(--paper);border:1px solid var(--mid);color:var(--ink);font-family:var(--mono);font-size:16px;padding:9px 12px;letter-spacing:4px;outline:none;border-radius:2px;transition:border-color 0.15s;margin-bottom:12px;}
.ec-in:focus{border-color:var(--ink);}
.ec-in.shake{animation:inShake 0.35s;border-color:var(--accent);}
@keyframes inShake{0%,100%{transform:translateX(0)}25%{transform:translateX(-6px)}75%{transform:translateX(6px)}}
.ec-canvas{display:block;width:100%;border:1px solid var(--mid);background:var(--paper);border-radius:1px;}
.ec-btn{width:100%;padding:11px;background:var(--ink);color:white;border:none;font-family:var(--mono);font-size:12px;letter-spacing:3px;cursor:pointer;border-radius:2px;transition:background 0.15s,transform 0.1s,box-shadow 0.15s;margin-top:4px;}
.ec-btn:hover{background:#2d2a3e;box-shadow:0 4px 12px rgba(26,24,37,0.25);transform:translateY(-1px);}
.ec-btn:active{transform:translateY(0);box-shadow:none;}
/* grid */
.ec-grid{display:grid;gap:2px;margin-bottom:12px;}
.ec-cell{aspect-ratio:1;background:var(--paper);border:1.5px solid var(--mid);cursor:pointer;display:flex;align-items:center;justify-content:center;transition:border-color 0.15s,background 0.15s,transform 0.1s;position:relative;overflow:hidden;}
.ec-cell:hover{border-color:#888;transform:scale(1.04);z-index:1;}
.ec-cell.sel{border-color:var(--ink);background:rgba(26,24,37,0.06);animation:cellPop 0.2s cubic-bezier(0.175,0.885,0.32,1.6);}
@keyframes cellPop{0%{transform:scale(0.92)}100%{transform:scale(1)}}
.ec-cell.sel::after{content:'✓';position:absolute;bottom:1px;right:2px;font-family:var(--mono);font-size:7px;color:var(--ink);animation:checkIn 0.2s ease;}
@keyframes checkIn{0%{opacity:0;transform:scale(0)}100%{opacity:1;transform:scale(1)}}
/* slider */
.ec-track{width:100%;height:42px;background:var(--paper);border:1px solid var(--mid);position:relative;cursor:pointer;border-radius:2px;overflow:hidden;margin-bottom:6px;}
.ec-track-fill{height:100%;background:var(--ink);opacity:0.08;width:0%;pointer-events:none;}
.ec-zone{position:absolute;top:0;bottom:0;background:rgba(253,203,110,0.4);border-left:2px solid var(--yellow);border-right:2px solid var(--yellow);pointer-events:none;}
.ec-thumb{position:absolute;top:8px;bottom:8px;width:4px;background:var(--ink);left:0%;transform:translateX(-50%);pointer-events:none;border-radius:2px;}
.ec-track-label{font-family:var(--mono);font-size:9px;color:var(--dim);text-align:center;margin-bottom:10px;}
/* sequence */
.ec-seq-canvas{display:block;width:100%;height:68px;border:1px solid var(--mid);background:var(--paper);border-radius:2px;margin-bottom:10px;user-select:none;-webkit-user-select:none;pointer-events:none;}
.ec-seq-prog{font-family:var(--mono);font-size:11px;color:var(--dim);margin-bottom:10px;}
.ec-seq-prog span{color:var(--ink);}
.ec-keypad{display:grid;grid-template-columns:repeat(5,1fr);gap:4px;margin-bottom:12px;}
.ec-key{background:var(--paper);border:1px solid var(--mid);color:var(--ink);font-family:var(--mono);font-size:16px;padding:9px 0;cursor:pointer;border-radius:2px;transition:background 0.1s,transform 0.1s;text-align:center;}
.ec-key:hover{background:var(--mid);}
.ec-key:active{background:var(--ink);color:white;}
/* math */
.ec-math{font-family:var(--mono);font-size:15px;color:var(--ink);text-align:center;padding:16px;background:var(--paper);border:1px solid var(--mid);margin-bottom:12px;white-space:pre-line;line-height:2;border-radius:2px;}
/* stroop */
.ec-stroop-word{font-size:40px;font-weight:700;text-align:center;margin-bottom:14px;}
@keyframes stroopIn{from{opacity:0;transform:scale(0.5) rotate(-5deg)}to{opacity:1;transform:scale(1) rotate(0)}}
.ec-color-row{display:flex;gap:6px;margin-bottom:12px;}
.ec-swatch{flex:1;height:48px;border:2px solid transparent;border-radius:2px;cursor:pointer;transition:transform 0.15s cubic-bezier(0.175,0.885,0.32,1.4),border-color 0.15s,box-shadow 0.15s;position:relative;}
.ec-swatch.sel{box-shadow:0 4px 12px rgba(0,0,0,0.2);}
.ec-swatch:hover{transform:scale(1.04);}
.ec-swatch.sel{border-color:var(--ink);}
.ec-swatch-label{position:absolute;bottom:3px;left:0;right:0;text-align:center;font-family:var(--mono);font-size:8px;color:rgba(0,0,0,0.4);}
/* dial */
.ec-dial-wrap{display:flex;justify-content:center;margin-bottom:10px;}
.ec-dial{width:140px;height:140px;border-radius:50%;border:2px solid var(--mid);position:relative;cursor:grab;background:var(--paper);display:flex;align-items:center;justify-content:center;user-select:none;}
.ec-dial:active{cursor:grabbing;}
.ec-dial-handle{position:absolute;width:12px;height:12px;background:var(--accent);border-radius:50%;pointer-events:none;}
.ec-dial-center{width:8px;height:8px;background:var(--ink);border-radius:50%;}
.ec-dial-hint{font-family:var(--mono);font-size:10px;color:var(--dim);text-align:center;margin-bottom:10px;}
.ec-dial-target{font-family:var(--mono);font-size:10px;color:#a07c00;background:#fffbf0;border:1px solid var(--yellow);padding:5px 10px;text-align:center;margin-bottom:10px;border-radius:2px;}
/* morse */
.ec-morse{font-family:var(--mono);font-size:16px;letter-spacing:3px;text-align:center;color:var(--ink);padding:14px;background:var(--paper);border:1px solid var(--mid);margin-bottom:12px;border-radius:2px;word-break:break-all;line-height:1.8;}
@keyframes morseIn{from{letter-spacing:-2px;opacity:0}to{letter-spacing:3px;opacity:1}}
.ec-morse-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:5px;margin-bottom:12px;}
.ec-morse-btn{background:var(--paper);border:1px solid var(--mid);color:var(--ink);font-family:var(--mono);font-size:18px;padding:12px 0;cursor:pointer;border-radius:2px;transition:background 0.1s,transform 0.1s,box-shadow 0.15s;}
.ec-morse-btn:hover{background:var(--mid);transform:translateY(-2px);box-shadow:0 3px 8px rgba(0,0,0,0.1);}
.ec-morse-btn:hover{background:var(--mid);}
.ec-morse-btn:active{background:var(--ink);color:white;}
/* reaction */
.ec-react-box{width:100%;height:130px;background:var(--paper);border:1px solid var(--mid);display:flex;align-items:center;justify-content:center;cursor:pointer;margin-bottom:8px;border-radius:2px;overflow:hidden;}
.ec-react-hint{font-family:var(--mono);font-size:10px;color:var(--dim);text-align:center;margin-bottom:10px;}
/* sort */
.ec-sort-slots{display:flex;gap:4px;margin-bottom:8px;}
.ec-sort-slot{flex:1;height:46px;border:1px dashed #ccc;border-radius:2px;display:flex;align-items:center;justify-content:center;font-family:var(--mono);font-size:15px;color:var(--dim);}
@keyframes slotPop{0%{transform:scale(0.8)}60%{transform:scale(1.1)}100%{transform:scale(1)}}
.ec-sort-slot.filled{border-style:solid;border-color:var(--ink);color:var(--ink);background:var(--paper);}
.ec-sort-items{display:flex;gap:4px;flex-wrap:wrap;margin-bottom:12px;}
.ec-sort-num{background:var(--paper);border:1.5px solid var(--mid);color:var(--ink);font-family:var(--mono);font-size:15px;padding:9px 12px;cursor:pointer;border-radius:2px;transition:background 0.12s,transform 0.12s,box-shadow 0.12s;}
.ec-sort-num:hover{background:var(--mid);transform:translateY(-2px);box-shadow:0 3px 8px rgba(0,0,0,0.1);}
.ec-sort-num:active{transform:scale(0.94);}
.ec-sort-num:hover{background:var(--mid);}
.ec-sort-num.used{opacity:0.2;pointer-events:none;}
/* coord */
.ec-coord-hint{font-family:var(--mono);font-size:9px;color:var(--dim);text-align:center;margin-bottom:10px;}
/* binary / multi-choice */
.ec-mc-opts{display:grid;gap:5px;margin-bottom:12px;}
.ec-mc-btn{background:var(--paper);border:1px solid var(--mid);color:var(--ink);font-family:var(--mono);font-size:15px;padding:11px 0;cursor:pointer;border-radius:2px;transition:background 0.15s,border-color 0.15s,transform 0.1s,box-shadow 0.15s;text-align:center;}
.ec-mc-btn:hover{background:var(--mid);border-color:#aaa;transform:translateY(-2px);box-shadow:0 3px 8px rgba(0,0,0,0.1);}
.ec-mc-btn:active{transform:translateY(0);box-shadow:none;background:var(--ink);color:white;}
/* hex */
.ec-hex-display{font-family:var(--mono);font-size:26px;letter-spacing:4px;text-align:center;padding:18px;background:var(--paper);border:1px solid var(--mid);margin-bottom:12px;border-radius:2px;}
.ec-hex-swatches{display:flex;gap:6px;margin-bottom:12px;}
.ec-hex-swatch{flex:1;height:56px;border:2px solid transparent;border-radius:2px;cursor:pointer;transition:transform 0.15s cubic-bezier(0.175,0.885,0.32,1.4),border-color 0.15s,box-shadow 0.15s;}
.ec-hex-swatch.sel{box-shadow:0 4px 14px rgba(0,0,0,0.22);transform:scale(1.06)!important;}
.ec-hex-swatch:hover{transform:scale(1.04);}
.ec-hex-swatch.sel{border-color:var(--ink);}
/* wave opts */
.ec-wave-opts{display:grid;grid-template-columns:1fr 1fr;gap:6px;margin-bottom:12px;}
.ec-wave-opt{border:2px solid var(--mid);border-radius:2px;cursor:pointer;overflow:hidden;transition:border-color 0.1s;}
.ec-wave-opt:hover{border-color:#999;}
.ec-wave-opt.sel{border-color:var(--ink);}
/* pattern memory */
.ec-mem-grid{display:grid;gap:3px;margin-bottom:10px;}
.ec-mem-cell{aspect-ratio:1;border-radius:2px;transition:background 0.2s,transform 0.15s;}
.ec-mem-cell.on{animation:memFlash 0.2s ease;}
@keyframes memFlash{0%{transform:scale(0.85)}60%{transform:scale(1.1)}100%{transform:scale(1)}}
.ec-mem-cell.on{background:var(--ink);}
.ec-mem-cell.off{background:var(--mid);}
.ec-mem-cell.inp{cursor:pointer;}
.ec-mem-cell.inp:hover{background:#888;}
.ec-mem-cell.inp.sel{background:var(--ink);}
/* tap target */
.ec-tap-box{width:100%;height:90px;background:var(--paper);border:1px solid var(--mid);border-radius:2px;display:flex;align-items:center;justify-content:center;font-family:var(--mono);font-size:13px;color:var(--dim);cursor:pointer;margin-bottom:8px;transition:background 0.05s,transform 0.06s;position:relative;overflow:hidden;}
.ec-tap-box:active{background:var(--mid);transform:scale(0.98);}
.ec-tap-ripple{position:absolute;border-radius:50%;background:rgba(26,24,37,0.12);width:10px;height:10px;transform:scale(0);animation:tapRipple 0.5s ease-out forwards;pointer-events:none;}
@keyframes tapRipple{to{transform:scale(30);opacity:0;}}
.ec-tap-count{font-family:var(--mono);font-size:32px;text-align:center;color:var(--ink);margin-bottom:4px;}
.ec-tap-target{font-family:var(--mono);font-size:11px;text-align:center;color:var(--dim);margin-bottom:12px;}
/* sequence recall */
.ec-recall-display{font-family:var(--mono);font-size:13px;background:var(--paper);border:1px solid var(--mid);padding:12px;border-radius:2px;margin-bottom:10px;min-height:44px;display:flex;align-items:center;justify-content:center;gap:8px;flex-wrap:wrap;}
.ec-recall-token{font-size:18px;font-weight:600;color:var(--ink);}
/* logic */
.ec-logic-box{background:var(--paper);border:1px solid var(--mid);border-radius:2px;padding:14px;margin-bottom:12px;font-family:var(--mono);font-size:13px;color:var(--ink);line-height:2;}
/* type */
.ec-type-display{font-family:var(--mono);font-size:24px;text-align:center;padding:16px;background:var(--paper);border:1px solid var(--mid);margin-bottom:8px;border-radius:2px;letter-spacing:5px;word-break:break-all;}
/* simon */
.ec-simon-grid{display:grid;grid-template-columns:1fr 1fr;gap:6px;margin-bottom:12px;}
.ec-simon-btn{height:80px;border-radius:3px;cursor:pointer;border:none;transition:filter 0.15s,transform 0.1s,box-shadow 0.15s;position:relative;}
.ec-simon-btn:hover{transform:translateY(-2px);box-shadow:0 6px 16px rgba(0,0,0,0.2);}
.ec-simon-btn:active{transform:scale(0.96);filter:brightness(1.4);box-shadow:none;}
.ec-simon-label{position:absolute;bottom:6px;left:0;right:0;text-align:center;font-family:var(--mono);font-size:9px;opacity:0.5;color:white;}
/* double slider */
.ec-slider-label{font-family:var(--mono);font-size:9px;color:var(--dim);text-align:center;margin-bottom:8px;}
/* success */
.ec-success{display:none;text-align:center;padding:30px 0 10px;}
.ec-success .big-check{width:64px;height:64px;border-radius:50%;background:var(--green);display:flex;align-items:center;justify-content:center;margin:0 auto 14px;animation:sPop 0.5s cubic-bezier(0.175,0.885,0.32,1.4) forwards;box-shadow:0 0 0 0 rgba(0,184,148,0.4);}
.ec-success .big-check.ring{animation:sPop 0.5s cubic-bezier(0.175,0.885,0.32,1.4) forwards,sRing 0.8s 0.3s ease-out forwards;}
@keyframes sPop{from{transform:scale(0);opacity:0}50%{transform:scale(1.15)}to{transform:scale(1);opacity:1}}
@keyframes sRing{0%{box-shadow:0 0 0 0 rgba(0,184,148,0.5)}100%{box-shadow:0 0 0 30px rgba(0,184,148,0)}}
.ec-success h3{font-size:18px;font-weight:600;color:var(--ink);margin-bottom:6px;}
.ec-success p{font-family:var(--mono);font-size:10px;color:var(--dim);letter-spacing:1px;}

/* ═══════════ DOCS ═══════════ */
#docs-page{display:none;width:100%;max-width:800px;animation:docsIn 0.4s ease;}
@keyframes docsIn{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:none}}
.docs-hero{background:var(--ink);color:white;padding:44px;border-radius:3px 3px 0 0;position:relative;overflow:hidden;}
.docs-hero::before{content:'';position:absolute;left:-30px;bottom:-30px;width:200px;height:200px;border-radius:50%;border:50px solid rgba(255,255,255,0.03);}
.docs-hero::after{content:'';position:absolute;right:-20px;top:-20px;width:150px;height:150px;border-radius:50%;border:35px solid rgba(255,255,255,0.04);}
.docs-hero-tag{font-family:var(--mono);font-size:10px;letter-spacing:3px;color:var(--accent);margin-bottom:12px;}
.docs-hero h1{font-size:36px;font-weight:600;margin-bottom:8px;letter-spacing:-1px;}
.docs-hero p{font-size:14px;color:rgba(255,255,255,0.45);line-height:1.7;}
.docs-body{background:white;border:1px solid var(--mid);border-top:none;border-radius:0 0 3px 3px;}
.docs-nav{display:flex;gap:0;border-bottom:1px solid var(--mid);overflow-x:auto;}
.docs-nav-btn{font-family:var(--mono);font-size:10px;letter-spacing:2px;color:var(--dim);padding:12px 18px;border:none;background:none;cursor:pointer;white-space:nowrap;border-bottom:2px solid transparent;margin-bottom:-1px;transition:color 0.15s,border-color 0.15s;}
.docs-nav-btn:hover{color:var(--ink);}
.docs-nav-btn.active{color:var(--ink);border-bottom-color:var(--ink);}
.docs-tab{display:none;padding:32px 40px;}
.docs-tab.active{display:block;}
.docs-section{margin-bottom:32px;}
.docs-section:last-child{margin-bottom:0;}
.docs-section h2{font-size:11px;font-family:var(--mono);letter-spacing:3px;color:var(--dim);text-transform:uppercase;margin-bottom:14px;padding-bottom:8px;border-bottom:1px solid var(--mid);}
.docs-section p,.docs-section li{font-size:14px;color:#444;line-height:1.8;}
.docs-section ul{padding-left:20px;margin-bottom:10px;}
.docs-badge-row{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px;}
.docs-badge{font-family:var(--mono);font-size:10px;padding:4px 10px;border-radius:99px;border:1px solid var(--mid);color:var(--dim);}
.docs-badge.green{border-color:var(--green);color:var(--green);background:#f0fdf9;}
/* code block */
.docs-code-wrap{background:var(--ink);border-radius:3px;overflow:hidden;margin-bottom:16px;}
.docs-code-head{display:flex;align-items:center;justify-content:space-between;padding:10px 14px;border-bottom:1px solid rgba(255,255,255,0.06);}
.docs-code-lang{font-family:var(--mono);font-size:9px;letter-spacing:2px;color:rgba(255,255,255,0.3);}
.docs-copy-btn{font-family:var(--mono);font-size:9px;letter-spacing:1px;color:rgba(255,255,255,0.35);background:none;border:1px solid rgba(255,255,255,0.12);border-radius:2px;padding:4px 10px;cursor:pointer;transition:all 0.15s;}
.docs-copy-btn:hover{color:white;border-color:rgba(255,255,255,0.35);}
.docs-copy-btn.copied{color:var(--green);border-color:var(--green);}
.docs-code{font-family:var(--mono);font-size:12px;color:#c8dff0;padding:14px;white-space:pre;overflow-x:auto;line-height:1.75;max-height:400px;}
.docs-code .kw{color:#74b9ff;}.docs-code .str{color:#a8e6cf;}.docs-code .cmt{color:rgba(255,255,255,0.22);font-style:italic;}.docs-code .fn{color:#ffeaa7;}.docs-code .num{color:#fd79a8;}.docs-code .at{color:#e17055;}
/* api table */
.docs-table{width:100%;border-collapse:collapse;font-size:13px;margin-bottom:10px;}
.docs-table th{font-family:var(--mono);font-size:9px;letter-spacing:2px;color:var(--dim);text-align:left;padding:8px 12px;border-bottom:1px solid var(--mid);font-weight:500;}
.docs-table td{padding:10px 12px;border-bottom:1px solid var(--mid);color:#444;vertical-align:top;}
.docs-table tr:last-child td{border-bottom:none;}
.docs-table td:first-child{font-family:var(--mono);font-size:12px;color:var(--ink);white-space:nowrap;}
.docs-table td code{font-family:var(--mono);font-size:11px;background:var(--paper);padding:2px 6px;border-radius:2px;color:var(--blue);}
/* challenge list */
.challenge-list{display:flex;flex-direction:column;gap:6px;}
.challenge-row{display:flex;gap:0;border:1px solid var(--mid);border-radius:2px;overflow:hidden;}
.challenge-num{font-family:var(--mono);font-size:11px;color:white;background:var(--ink);padding:8px 12px;display:flex;align-items:center;justify-content:center;min-width:42px;}
.challenge-name{font-family:var(--mono);font-size:12px;color:var(--ink);background:var(--paper);padding:8px 14px;min-width:160px;border-right:1px solid var(--mid);display:flex;align-items:center;}
.challenge-desc{font-size:13px;color:#555;padding:8px 14px;display:flex;align-items:center;}
.challenge-tag{font-family:var(--mono);font-size:9px;padding:2px 8px;border-radius:99px;margin-left:auto;flex-shrink:0;align-self:center;}
.tag-memory{background:#f0f7ff;color:#0984e3;border:1px solid #74b9ff;}
.tag-logic{background:#f5f0ff;color:#6c5ce7;border:1px solid #a29bfe;}
.tag-endure{background:#fff5f5;color:var(--accent);border:1px solid #fab1a0;}
.tag-trick{background:#fffbf0;color:#a07c00;border:1px solid var(--yellow);}
.tag-skill{background:#f0fdf9;color:#00b894;border:1px solid #55efc4;}
/* steps */
.docs-steps{display:flex;flex-direction:column;gap:10px;}
.docs-step{display:flex;gap:14px;align-items:flex-start;}
.docs-step-num{font-family:var(--mono);font-size:11px;color:white;background:var(--ink);width:24px;height:24px;border-radius:50%;display:flex;align-items:center;justify-content:center;flex-shrink:0;margin-top:1px;}
.docs-step-text{font-size:14px;color:#444;line-height:1.7;}
.docs-step-text strong{color:var(--ink);}

/* ══ ADVANCED ANIMATIONS ══ */
/* fail flash on header */
@keyframes failFlash{0%{background:var(--paper)}20%{background:#fff0f0}60%{background:#ffe8e8}100%{background:var(--paper)}}
/* slot pop */
@keyframes slotPop{0%{transform:scale(0.7)}60%{transform:scale(1.12)}100%{transform:scale(1)}}
/* Stroop word entrance */
@keyframes stroopIn{0%{opacity:0;transform:scale(0.7) rotate(-5deg)}60%{transform:scale(1.08) rotate(1deg)}100%{opacity:1;transform:scale(1) rotate(0deg)}}
/* Morse entrance */
@keyframes morseIn{0%{opacity:0;letter-spacing:8px}100%{opacity:1;letter-spacing:3px}}
/* counter number pop */
@keyframes countPop{0%{transform:scale(1)}40%{transform:scale(1.4)}100%{transform:scale(1)}}
/* shell card shuffle shimmer */
@keyframes cardShimmer{0%,100%{opacity:1}50%{opacity:0.6}}
/* C35 target spawn pulse */
@keyframes targetSpawn{0%{transform:scale(0);opacity:0}60%{transform:scale(1.3)}100%{transform:scale(1);opacity:1}}
/* Simon button active glow */
@keyframes simonGlow{0%,100%{box-shadow:none}50%{box-shadow:0 0 20px 4px currentColor}}
/* progress dot trail */
@keyframes dotTrail{0%{transform:scale(1.5);opacity:1}100%{transform:scale(1);opacity:0.5}}
/* wave option hover lift */
.ec-wave-opt{transition:border-color 0.15s,transform 0.15s,box-shadow 0.15s;}
.ec-wave-opt:hover{transform:translateY(-3px);box-shadow:0 6px 16px rgba(0,0,0,0.12);}
.ec-wave-opt.sel{border-color:var(--ink)!important;box-shadow:0 0 0 2px rgba(26,24,37,0.15);}
/* dial handle glow on drag */
.ec-dial:active .ec-dial-handle,.ec-dial.dragging .ec-dial-handle{box-shadow:0 0 0 6px rgba(214,48,49,0.25);}
/* sort slot pulse when filled */
.ec-sort-slot.filled{animation:slotPop 0.25s cubic-bezier(0.175,0.885,0.32,1.6);}
/* dial spinning hint */
@keyframes dialSpin{from{transform:translate(-50%,-50%) rotate(0deg)}to{transform:translate(-50%,-50%) rotate(360deg)}}
/* ec-cell entry stagger */
@keyframes cellEntry{from{opacity:0;transform:scale(0.6)}to{opacity:1;transform:scale(1)}}
/* simon grid layout hover */
.ec-simon-btn{position:relative;overflow:hidden;}
.ec-simon-btn::after{content:'';position:absolute;inset:0;background:rgba(255,255,255,0);transition:background 0.2s;}
.ec-simon-btn:hover::after{background:rgba(255,255,255,0.12);}
/* Tap count pop */
.ec-tap-count{transition:transform 0.1s;}
/* Track fill smooth */
.ec-track-fill{transition:width 0.05s;}
/* Reaction box transition */
.ec-react-box{transition:background 0.1s;}
/* Input focus glow */
.ec-in:focus{border-color:var(--ink);box-shadow:0 0 0 3px rgba(26,24,37,0.08);}
/* shake enhanced */
@keyframes inShake{0%,100%{transform:translateX(0)}15%{transform:translateX(-8px)}30%{transform:translateX(7px)}45%{transform:translateX(-6px)}60%{transform:translateX(5px)}75%{transform:translateX(-3px)}90%{transform:translateX(2px)}}
/* modal body scroll fade */
.ecm-body{mask-image:linear-gradient(to bottom,transparent 0,black 12px,black calc(100% - 12px),transparent 100%);}
/* header shimmer on success */
@keyframes successShimmer{0%{background:var(--paper)}30%{background:#f0fdf9}100%{background:var(--paper)}}
/* challenge name type-in */
@keyframes nameSlide{from{opacity:0;transform:translateX(-12px)}to{opacity:1;transform:none}}

/* ══ C27 SHELL CARDS ══ */
.shell-card{
  position:absolute;
  width:90px;height:110px;
  border-radius:10px;
  display:flex;align-items:center;justify-content:center;
  font-family:var(--mono);font-size:22px;font-weight:700;color:white;
  cursor:default;
  top:50%;transform:translateY(-50%);
  box-shadow:0 4px 16px rgba(0,0,0,0.18);
  transition:left 0.38s cubic-bezier(0.4,0,0.2,1),
             top 0.38s cubic-bezier(0.4,0,0.2,1),
             transform 0.38s cubic-bezier(0.4,0,0.2,1),
             background 0.3s;
  user-select:none;
}
.shell-card.shuffle-up{transform:translateY(calc(-50% - 22px));}
.shell-card.clickable{cursor:pointer;}
.shell-card.clickable:hover{filter:brightness(1.15);transform:translateY(calc(-50% - 6px));box-shadow:0 10px 28px rgba(0,0,0,0.25);}
.shell-card.clickable:active{transform:translateY(calc(-50% - 2px));}
@keyframes cardReveal{0%{transform:translateY(calc(-50% - 30px));opacity:0}60%{transform:translateY(calc(-50% + 6px))}100%{transform:translateY(-50%);opacity:1}}
@keyframes cardWrong{0%,100%{transform:translateY(-50%) rotate(0deg)}20%{transform:translateY(-50%) rotate(-6deg)}40%{transform:translateY(-50%) rotate(6deg)}60%{transform:translateY(-50%) rotate(-4deg)}80%{transform:translateY(-50%) rotate(4deg)}}
@keyframes cardRight{0%{transform:translateY(-50%) scale(1)}40%{transform:translateY(-55%) scale(1.1)}100%{transform:translateY(-50%) scale(1)}}
</style>
</head>
<body>
<html>
<div class="field">
    <label>ユーザーネーム</label>
    <input type="text" id="username-inp" placeholder="ユーザーネームを入力..." autocomplete="off">
  </div>
 <div class="ecw" id="ecw" onclick="ecOpen()">
    <div class="ecw-box" id="ecw-box">
      <div class="spin"></div>
      <svg width="13" height="11" viewBox="0 0 13 11" fill="none"><polyline points="1,5.5 5,9.5 12,1" stroke="#00b894" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"/></svg>
    </div>
    <div class="ecw-text">
      <div class="main" id="ecw-label">私はロボットではありません</div>
      <div class="sub2" id="ecw-sub">WT*Rca v4.0</div>
    </div>
    <div class="ecw-badge">
      <div class="ecw-badge-icon">
        <svg width="16" height="16" viewBox="0 0 16 16" fill="none"><rect x="2" y="2" width="5" height="5" fill="white" opacity="0.9"/><rect x="9" y="2" width="5" height="5" fill="white" opacity="0.9"/><rect x="2" y="9" width="5" height="5" fill="white" opacity="0.9"/><rect x="10" y="10" width="3" height="3" fill="white" opacity="0.9"/></svg>
      </div>
      <div class="ecw-badge-label">WT*Rca</div>
    </div>
  </div>

<!-- ═══════════ MODAL ═══════════ -->
<div class="eco" id="eco">
  <div class="ecm">
    <div class="ecm-head">
      <div class="ecm-title">
        <h3>WHAT THE F*** RECAPTCHA PROTOCOL</h3>
        <p id="ecm-name">—</p>
      </div>
      <div class="ecm-meta">
        <div class="ecm-timer" id="ecm-timer">—</div>
        <button class="ecm-close" onclick="ecClose()">✕</button>
      </div>
    </div>
    <div class="ecm-dots" id="ecm-dots"></div>
    <div class="ecm-body">
      <div class="ec-status" id="ec-status"></div>

      <div class="ec-ch" id="ec1">
        <div class="ec-q">歪んだ文字を読んで入力してください。<br><small style="color:var(--dim)">クリックで再生成 / −2秒ペナルティ</small></div>
        <canvas class="ec-canvas" id="c1-cv" height="90" style="cursor:pointer;margin-bottom:5px;"></canvas>
        <div style="font-family:var(--mono);font-size:9px;color:var(--dim);text-align:right;margin-bottom:10px;">CLICK TO REFRESH (–2s)</div>
        <input class="ec-in" id="c1-in" placeholder="入力..." maxlength="8" autocomplete="off" spellcheck="false">
        <button class="ec-btn" onclick="chkC1()">VERIFY</button>
      </div>

      <div class="ec-ch" id="ec2">
        <div class="ec-q" id="c2-q"></div>
        <div class="ec-grid" id="c2-grid" style="grid-template-columns:repeat(6,1fr)"></div>
        <button class="ec-btn" onclick="chkC2()">VERIFY</button>
      </div>

      <div class="ec-ch" id="ec3">
        <div class="ec-q">スライダーを<strong>黄色のゾーン</strong>に合わせてください。<small style="color:var(--dim)"> ゾーン幅5%</small></div>
        <div class="ec-track" id="c3-track"><div class="ec-track-fill" id="c3-fill"></div><div class="ec-zone" id="c3-zone"></div><div class="ec-thumb" id="c3-thumb"></div></div>
        <div class="ec-track-label">ドラッグ or クリック</div>
        <button class="ec-btn" onclick="chkC3()">VERIFY</button>
      </div>

      <div class="ec-ch" id="ec4">
        <div class="ec-q">数列を<strong>逆順</strong>で入力してください。<small style="color:var(--dim)"> 3秒で消えます</small></div>
        <canvas class="ec-seq-canvas" id="c4-cv" height="68"></canvas>
        <div class="ec-seq-prog">入力: <span id="c4-entered">—</span></div>
        <div class="ec-keypad" id="c4-keys"></div>
      </div>

      <div class="ec-ch" id="ec5">
        <div class="ec-q">計算結果を入力してください。</div>
        <div class="ec-math" id="c5-math"></div>
        <input class="ec-in" type="number" id="c5-in" placeholder="答え..." style="letter-spacing:2px;">
        <button class="ec-btn" onclick="chkC5()">VERIFY</button>
      </div>

      <div class="ec-ch" id="ec6">
        <div class="ec-q">文字が示す<strong>色名</strong>と一致する色を選んでください。<small style="color:var(--dim)">（ストループ効果）</small></div>
        <div class="ec-stroop-word" id="c6-word"></div>
        <div class="ec-color-row" id="c6-swatches"></div>
        <button class="ec-btn" onclick="chkC6()">VERIFY</button>
      </div>

      <div class="ec-ch" id="ec7">
        <div class="ec-q">赤い点を指定の角度に回してください。</div>
        <div class="ec-dial-target" id="c7-target-label"></div>
        <div class="ec-dial-wrap"><div class="ec-dial" id="c7-dial"><div class="ec-dial-handle" id="c7-handle"></div><div class="ec-dial-center"></div></div></div>
        <div class="ec-dial-hint" id="c7-hint">0°</div>
        <button class="ec-btn" onclick="chkC7()">VERIFY</button>
      </div>

      <div class="ec-ch" id="ec8">
        <div class="ec-q">モールス信号を解読して数字を選んでください。</div>
        <div class="ec-morse" id="c8-morse"></div>
        <div class="ec-morse-grid" id="c8-opts"></div>
      </div>

      <div class="ec-ch" id="ec9">
        <div class="ec-q">グラフ上の<strong>赤い × 印</strong>をクリックしてください。<small style="color:var(--dim)"> ±12px</small></div>
        <canvas id="c9-cv" style="display:block;width:100%;height:200px;background:var(--paper);border:1px solid var(--mid);border-radius:2px;margin-bottom:8px;cursor:crosshair;" width="480" height="200"></canvas>
        <div class="ec-coord-hint" id="c9-hint">キャンバスをクリック</div>
        <button class="ec-btn" onclick="chkC9()">VERIFY</button>
      </div>

      <div class="ec-ch" id="ec10">
        <div class="ec-q">数字を<strong>小さい順</strong>にタップして並べてください。</div>
        <div class="ec-sort-slots" id="c10-slots"></div>
        <div class="ec-sort-items" id="c10-items"></div>
        <button class="ec-btn" onclick="chkC10()">VERIFY</button>
      </div>

      <div class="ec-ch" id="ec11">
        <div class="ec-q">四角が<strong>赤くなったら</strong>すぐクリック！<small style="color:var(--dim)"> フェイクあり</small></div>
        <div class="ec-react-box" id="c11-box" onclick="reactClick()"><canvas id="c11-cv" width="460" height="118"></canvas></div>
        <div class="ec-react-hint" id="c11-hint">待機中...</div>
      </div>

      <div class="ec-ch" id="ec12">
        <div class="ec-q">2進数を10進数に変換してください。</div>
        <div class="ec-binary" id="c12-bin" style="font-family:var(--mono);font-size:22px;letter-spacing:4px;text-align:center;padding:14px;background:var(--paper);border:1px solid var(--mid);margin-bottom:12px;border-radius:2px;"></div>
        <div class="ec-mc-opts" id="c12-opts" style="grid-template-columns:repeat(4,1fr);"></div>
      </div>

      <div class="ec-ch" id="ec13">
        <div class="ec-q">HEXカラーコードに一致する色を選んでください。</div>
        <div class="ec-hex-display" id="c13-hex"></div>
        <div class="ec-hex-swatches" id="c13-swatches"></div>
        <button class="ec-btn" onclick="chkC13()">VERIFY</button>
      </div>

      <div class="ec-ch" id="ec14">
        <div class="ec-q">上の波形と<strong>同じパターン</strong>を選んでください。</div>
        <canvas id="c14-target" style="display:block;width:100%;height:90px;border:1px solid var(--mid);background:var(--paper);border-radius:2px;margin-bottom:10px;" width="460" height="90"></canvas>
        <div class="ec-wave-opts" id="c14-opts"></div>
        <button class="ec-btn" id="c14-btn" onclick="chkC14()">VERIFY</button>
      </div>

      <div class="ec-ch" id="ec15">
        <div class="ec-q" id="c15-q"></div>
        <canvas id="c15-cv" style="display:block;width:100%;height:200px;border:1px solid var(--mid);background:var(--paper);border-radius:2px;margin-bottom:12px;" height="200"></canvas>
        <div class="ec-mc-opts" id="c15-opts" style="grid-template-columns:repeat(4,1fr);"></div>
      </div>

      <div class="ec-ch" id="ec16">
        <div class="ec-q">パターンを<strong>30秒間記憶</strong>して、消えたら同じパターンを再現してください。</div>
        <div style="font-family:var(--mono);font-size:10px;color:var(--dim);margin-bottom:8px;" id="c16-phase">記憶中...</div>
        <div class="ec-mem-grid" id="c16-grid" style="grid-template-columns:repeat(5,1fr);max-width:250px;margin:0 auto 12px;"></div>
        <button class="ec-btn" id="c16-btn" onclick="chkC16()" style="display:none;">VERIFY</button>
      </div>

      <div class="ec-ch" id="ec17">
        <div class="ec-q">目標回数だけ<strong>タップ</strong>してください。ぴったりで止めること！</div>
        <div class="ec-tap-count" id="c17-count">0</div>
        <div class="ec-tap-target" id="c17-target-label">目標: —</div>
        <div class="ec-tap-box" id="c17-tap" onclick="tapIt(event)">TAP HERE</div>
        <button class="ec-btn" onclick="chkC17()">VERIFY</button>
      </div>

      <div class="ec-ch" id="ec18">
        <div class="ec-q">表示された色の順番を<strong>記憶</strong>して同じ順にボタンを押してください。</div>
        <div style="font-family:var(--mono);font-size:10px;color:var(--dim);margin-bottom:10px;" id="c18-phase">シーケンス再生中...</div>
        <div class="ec-simon-grid" id="c18-grid"></div>
        <div style="font-family:var(--mono);font-size:11px;color:var(--dim);text-align:center;margin-bottom:10px;">入力: <span id="c18-progress">—</span></div>
      </div>

      <div class="ec-ch" id="ec19">
        <div class="ec-q">論理パズルを解いてください。</div>
        <div class="ec-logic-box" id="c19-logic"></div>
        <div class="ec-mc-opts" id="c19-opts" style="grid-template-columns:1fr 1fr;"></div>
      </div>

      <div class="ec-ch" id="ec20">
        <div class="ec-q">記号混じりの文字列をタイプしてください。<small style="color:var(--dim)"> タイムアタック</small></div>
        <div class="ec-type-display" id="c20-target"></div>
        <div style="font-family:var(--mono);font-size:9px;color:var(--dim);text-align:center;margin-bottom:10px;">大文字小文字・記号すべて一致</div>
        <input class="ec-in" id="c20-in" placeholder="タイプ..." autocomplete="off" spellcheck="false" style="letter-spacing:3px;">
        <button class="ec-btn" onclick="chkC20()">VERIFY</button>
      </div>

      <div class="ec-ch" id="ec21">
        <div class="ec-q"><strong>2本のスライダー</strong>を同時に指定ゾーンへ合わせてください。</div>
        <div class="ec-track" id="c21a-track" style="margin-bottom:4px;"><div class="ec-track-fill" id="c21a-fill"></div><div class="ec-zone" id="c21a-zone"></div><div class="ec-thumb" id="c21a-thumb"></div></div>
        <div class="ec-slider-label">スライダー A</div>
        <div class="ec-track" id="c21b-track" style="margin-bottom:4px;"><div class="ec-track-fill" id="c21b-fill"></div><div class="ec-zone" id="c21b-zone"></div><div class="ec-thumb" id="c21b-thumb"></div></div>
        <div class="ec-slider-label">スライダー B</div>
        <button class="ec-btn" onclick="chkC21()">VERIFY</button>
      </div>

      <div class="ec-ch" id="ec22">
        <div class="ec-q">数列の<strong>次の数</strong>を答えてください。</div>
        <div class="ec-math" id="c22-seq"></div>
        <div class="ec-mc-opts" id="c22-opts" style="grid-template-columns:repeat(4,1fr);"></div>
      </div>

      <div class="ec-ch" id="ec23">
        <div class="ec-q">フラッシュしたパターンを順番通りに入力してください。<small style="color:var(--dim)"> 位置を覚える</small></div>
        <div style="font-family:var(--mono);font-size:10px;color:var(--dim);margin-bottom:8px;" id="c23-phase">準備中...</div>
        <div class="ec-mem-grid" id="c23-grid" style="grid-template-columns:repeat(4,1fr);max-width:220px;margin:0 auto 12px;gap:4px;"></div>
        <div style="font-family:var(--mono);font-size:11px;color:var(--dim);text-align:center;margin-bottom:10px;">入力順: <span id="c23-prog">—</span></div>
      </div>

      <div class="ec-ch" id="ec24">
        <div class="ec-q">グラフの<strong>2つの × 印</strong>を順番に（赤→青）クリックしてください。<small style="color:var(--dim)"> ±14px</small></div>
        <canvas id="c24-cv" style="display:block;width:100%;height:210px;background:var(--paper);border:1px solid var(--mid);border-radius:2px;margin-bottom:8px;cursor:crosshair;" width="480" height="210"></canvas>
        <div class="ec-coord-hint" id="c24-hint">赤い × をクリックしてください</div>
        <button class="ec-btn" onclick="chkC24()">VERIFY</button>
      </div>

      <div class="ec-ch" id="ec25">
        <div class="ec-q">指定された時間（秒）を<strong>自分でカウント</strong>してボタンを押してください。<small style="color:var(--dim)"> ±0.8秒以内</small></div>
        <div class="ec-type-display" id="c25-target-label" style="font-size:42px;letter-spacing:0;"></div>
        <div style="font-family:var(--mono);font-size:10px;color:var(--dim);text-align:center;margin-bottom:12px;">秒後にボタンを押す</div>
        <button class="ec-btn" id="c25-btn" onclick="chkC25()">NOW</button>
      </div>

      <div class="ec-ch" id="ec26">
        <div class="ec-q">繰り返しパターンの<strong>抜けている部分</strong>を答えてください。</div>
        <div class="ec-logic-box" id="c26-pattern"></div>
        <div class="ec-mc-opts" id="c26-opts" style="grid-template-columns:repeat(4,1fr);"></div>
      </div>

      <div class="ec-ch" id="ec27">
        <div class="ec-q">3枚のカードをシャッフルします。<strong>赤いカード</strong>を追ってください。</div>
        <div id="c27-arena" style="position:relative;height:160px;margin-bottom:10px;border:1px solid var(--mid);border-radius:2px;background:var(--paper);overflow:hidden;"></div>
        <div style="font-family:var(--mono);font-size:10px;color:var(--dim);text-align:center;margin-bottom:10px;" id="c27-hint">シャッフル中...</div>
        <div style="display:flex;gap:6px;margin-bottom:12px;" id="c27-btns"></div>
      </div>

      <div class="ec-ch" id="ec28">
        <div class="ec-q">鏡像（水平反転）を選んでください。</div>
        <div id="c28-wrap" style="margin-bottom:12px;"></div>
      </div>

      <div class="ec-ch" id="ec29">
        <div class="ec-q">指定回数だけ<strong>連打</strong>してください。ジャスト！<small style="color:var(--dim)"> 超えたら失敗</small></div>
        <div class="ec-tap-count" id="c29-count">0</div>
        <div class="ec-tap-target" id="c29-target-label">目標: —</div>
        <div class="ec-tap-box" id="c29-tap" onclick="tapC29(event)">SPAM HERE</div>
        <button class="ec-btn" onclick="chkC29()">VERIFY</button>
      </div>

      <div class="ec-ch" id="ec30">
        <div class="ec-q">赤点が現れてから<strong>ちょうど指定秒後</strong>にクリック。<small style="color:var(--dim)"> ±0.6秒</small></div>
        <div class="ec-react-box" id="c30-box" style="cursor:default;flex-direction:column;gap:8px;">
          <canvas id="c30-cv" width="460" height="60"></canvas>
          <div style="font-family:var(--mono);font-size:11px;color:var(--dim);" id="c30-sub">—</div>
        </div>
        <div style="margin-top:8px;"><button class="ec-btn" id="c30-click-btn" onclick="chkC30()" disabled>CLICK NOW</button></div>
      </div>

      <div class="ec-ch" id="ec31">
        <div class="ec-q">16進数を10進数に変換してください。</div>
        <div class="ec-hex-display" id="c31-hex" style="font-size:30px;"></div>
        <div class="ec-mc-opts" id="c31-opts" style="grid-template-columns:repeat(4,1fr);"></div>
      </div>

      <div class="ec-ch" id="ec32">
        <div class="ec-q">表示された数字を<strong>3秒で覚えて</strong>から、昇順に並べてください。<small style="color:var(--dim)"> 消えたら並べる</small></div>
        <canvas class="ec-seq-canvas" id="c32-cv" height="68" style="margin-bottom:10px;"></canvas>
        <div style="font-family:var(--mono);font-size:10px;color:var(--dim);margin-bottom:8px;" id="c32-phase">記憶中...</div>
        <div class="ec-sort-slots" id="c32-slots"></div>
        <div class="ec-sort-items" id="c32-items"></div>
        <button class="ec-btn" id="c32-btn" onclick="chkC32()" style="display:none;">VERIFY</button>
      </div>

      <div class="ec-ch" id="ec33">
        <div class="ec-q">条件を読んで答えを選んでください。</div>
        <div class="ec-logic-box" id="c33-logic"></div>
        <div class="ec-mc-opts" id="c33-opts" style="grid-template-columns:1fr 1fr;"></div>
      </div>

      <div class="ec-ch" id="ec34">
        <div class="ec-q"><strong>3本のスライダー</strong>を全部同時に指定ゾーンへ合わせてください。</div>
        <div class="ec-track" id="c34a-track" style="margin-bottom:4px;"><div class="ec-track-fill" id="c34a-fill"></div><div class="ec-zone" id="c34a-zone"></div><div class="ec-thumb" id="c34a-thumb"></div></div>
        <div class="ec-slider-label">スライダー A</div>
        <div class="ec-track" id="c34b-track" style="margin-bottom:4px;"><div class="ec-track-fill" id="c34b-fill"></div><div class="ec-zone" id="c34b-zone"></div><div class="ec-thumb" id="c34b-thumb"></div></div>
        <div class="ec-slider-label">スライダー B</div>
        <div class="ec-track" id="c34c-track" style="margin-bottom:4px;"><div class="ec-track-fill" id="c34c-fill"></div><div class="ec-zone" id="c34c-zone"></div><div class="ec-thumb" id="c34c-thumb"></div></div>
        <div class="ec-slider-label">スライダー C</div>
        <button class="ec-btn" onclick="chkC34()">VERIFY</button>
      </div>

      <div class="ec-ch" id="ec35">
        <div class="ec-q">ランダムな速さで流れる<strong>すべてのボタン</strong>を逃さずクリックしてください！<small style="color:var(--dim)"> 全部クリックで成功</small></div>
        <canvas id="c35-cv" style="display:block;width:100%;height:220px;border:1px solid var(--mid);background:var(--paper);border-radius:2px;margin-bottom:8px;cursor:pointer;" height="220"></canvas>
        <div style="font-family:var(--mono);font-size:11px;color:var(--dim);text-align:center;margin-bottom:10px;">残り: <span id="c35-remain">—</span></div>
      </div>

      <div class="ec-success" id="ec-success">
        <div class="big-check"><svg width="28" height="22" viewBox="0 0 28 22" fill="none"><polyline points="2,11 10,19 26,2" stroke="white" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/></svg></div>
        <h3>確認完了</h3>
        <p>HUMAN_CONFIRMED // WT*Rca™ v4.0</p>
      </div>
    </div>
  </div>
</div>
<script>
'use strict';
const S={
  verified:false,current:0,total:35,order:[],timerInt:null,_failing:false,
  c1text:'',
  c2correct:[],
  c3val:0,c3target:{},c3drag:false,
  c4seq:null,c4answer:[],c4entered:[],c4t:null,
  c5answer:0,
  c6correct:-1,c6sel:-1,
  c7angle:0,c7target:{},c7drag:false,c7cleanup:null,
  c8answer:'',
  c9target:{},c9click:null,
  c10answer:[],c10slots:[],
  c11red:false,c11done:false,c11t:null,
  c12answer:0,
  c13correct:-1,c13sel:-1,
  c14correct:-1,c14sel:-1,c14p:null,
  c15answer:0,
  c16pattern:[],c16input:[],c16phase:'show',c16t:null,
  c17target:0,c17count:0,
  c18seq:[],c18input:[],c18phase:'show',
  c19answer:'',
  c20target:'',
  c21aval:0,c21atarget:{},c21adrag:false,c21bval:0,c21btarget:{},c21bdrag:false,
  c22answer:0,
  c23seq:[],c23input:[],c23phase:'show',
  c24tA:{},c24tB:{},c24step:0,c24clickA:null,c24clickB:null,
  c25target:0,c25startTime:0,
  c26answer:'',
  c27cards:[0,1,2],c27red:0,c27phase:'show',
  c28correct:-1,c28sel:-1,
  c29target:0,c29count:0,c29over:false,
  c30target:0,c30startTime:0,c30started:false,
  c31answer:0,
  c32nums:null,c32answer:[],c32slots:[],c32phase:'show',c32t:null,
  c33answer:'',
  c34aval:0,c34atarget:{},c34adrag:false,c34bval:0,c34btarget:{},c34bdrag:false,c34cval:0,c34ctarget:{},c34cdrag:false,
  c35targets:[],c35clicked:0,c35total:0,c35int:null,c35rafId:null,c35running:false,c35spawnTimers:[],
  c27timers:[],
  c11timers:[],c18timers:[],c23timers:[],c30t:null,
};
const ALL=Array.from({length:35},(_,i)=>i+1);
const TIMERS={1:12,2:20,3:9,4:22,5:14,6:7,7:12,8:15,9:13,10:18,11:10,12:12,13:10,14:15,15:18,16:35,17:15,18:25,19:20,20:15,21:12,22:15,23:20,24:15,25:20,26:15,27:18,28:12,29:12,30:20,31:12,32:25,33:25,34:14,35:20};
const CNAMES={1:'歪み文字認識',2:'混沌図形グリッド',3:'精密スライダー',4:'逆順記憶',5:'数式計算',6:'ストループ効果',7:'ダイヤル回転',8:'モールス解読',9:'座標クリック',10:'数字ソート',11:'リアクション',12:'2進数変換',13:'HEXカラー照合',14:'波形マッチング',15:'図形カウント',16:'パターン記憶',17:'カウントタップ',18:'サイモン記憶',19:'論理パズル',20:'タイプアウト',21:'ダブルスライダー',22:'数列の次の数',23:'フラッシュ順記憶',24:'2点クリック',25:'時間感覚',26:'パターン補完',27:'シェルゲーム',28:'鏡像反転',29:'連打ジャスト',30:'遅延クリック',31:'16進数変換',32:'記憶ソート',33:'論理推論',34:'トリプルスライダー',35:'移動ターゲット'};

function ecOpen(){
  if(S.verified)return;
  const u=document.getElementById('username-inp').value.trim();
  if(!u){alert('ユーザーネームを入力してください');return;}
  S.order=[...ALL].sort(()=>Math.random()-0.5);S.current=0;buildDots();
  document.getElementById('eco').classList.add('open');
  document.getElementById('ecw').classList.add('loading');
  setTimeout(()=>{document.getElementById('ecw').classList.remove('loading');goNext();},500);
}
function cleanupAll(){
  stopTimer();killReact();clearC35();clearC27();clearC18();
  ['c23timers','c11timers'].forEach(k=>{if(S[k]){S[k].forEach(clearTimeout);S[k]=[];}});
  if(S.c7cleanup)S.c7cleanup();
  ['c4t','c16t','c32t','c30t'].forEach(k=>{if(S[k]){clearTimeout(S[k]);S[k]=null;}});
}
function ecClose(){cleanupAll();document.getElementById('eco').classList.remove('open');}
function buildDots(){
  const c=document.getElementById('ecm-dots');c.innerHTML='';
  for(let i=0;i<S.total;i++){const d=document.createElement('div');d.className='dot';d.id='d'+i;c.appendChild(d);}
}
function refreshDots(){
  for(let i=0;i<S.total;i++){
    const el=document.getElementById('d'+i);if(!el)continue;
    const prevClass=el.className;
    const newClass='dot'+(i<S.current?' done':i===S.current?' now':'');
    if(newClass!==prevClass&&newClass.includes('done')&&!prevClass.includes('done')){
      el.className=newClass;
      el.style.animation='none';void el.offsetWidth;el.style.animation='dotDone 0.4s cubic-bezier(0.175,0.885,0.32,1.6)';
    } else if(newClass!==prevClass){
      el.className=newClass;
    }
  }
}
function startTimer(n){
  stopTimer();let t=TIMERS[n];
  const el=document.getElementById('ecm-timer');el.textContent=t;el.className='ecm-timer';el.style.color='';
  S.timerInt=setInterval(()=>{t--;el.textContent=t;
    el.style.animation='none';void el.offsetWidth;el.style.animation='timerTick 0.2s ease';
    if(t<=3)el.className='ecm-timer hot';if(t<=0){stopTimer();fail('タイムオーバー');}},1000);
}
function stopTimer(){clearInterval(S.timerInt);}
function goNext(){
  if(S._failing)return; // don't advance mid-fail animation
  S.current++;
  if(S.current>S.total){onVerified();return;}
  refreshDots();clearStatus();
  const n=S.order[S.current-1];
  const nameEl=document.getElementById('ecm-name');nameEl.style.animation='none';void nameEl.offsetWidth;nameEl.textContent=`${S.current} / ${S.total} — ${CNAMES[n]}`;nameEl.style.animation='nameSlide 0.3s ease';
  document.querySelectorAll('.ec-ch').forEach(e=>e.classList.remove('active'));
  const nextEl=document.getElementById('ec'+n);
  nextEl.classList.add('active');
  nextEl.style.animation='none';void nextEl.offsetWidth;
  nextEl.style.animation='chSlide 0.28s cubic-bezier(0.22,1,0.36,1)';
  document.querySelector('.ecm-body').scrollTop=0;
  try{[initC1,initC2,initC3,initC4,initC5,initC6,initC7,initC8,initC9,initC10,initC11,initC12,initC13,initC14,initC15,initC16,initC17,initC18,initC19,initC20,initC21,initC22,initC23,initC24,initC25,initC26,initC27,initC28,initC29,initC30,initC31,initC32,initC33,initC34,initC35][n-1]();}catch(err){console.error('initC'+n+' error:',err);setStatus('err','エラー — スキップします');setTimeout(()=>goNext(),1200);}
  startTimer(n);
}
function fail(msg){
  if(S._failing)return; // prevent double-fail
  S._failing=true;
  cleanupAll();setStatus('err','✗ '+msg);
  const head=document.querySelector('.ecm-head');if(head){head.style.animation='none';void head.offsetWidth;head.style.animation='failFlash 0.5s ease';}
  setTimeout(()=>{S._failing=false;S.current=0;S.order=[...ALL].sort(()=>Math.random()-0.5);buildDots();goNext();},1900);
}
function onVerified(){
  stopTimer();document.querySelectorAll('.ec-ch').forEach(e=>e.classList.remove('active'));
  const sc=document.getElementById('ec-success');sc.style.display='block';
  setTimeout(()=>{const bc=sc.querySelector('.big-check');if(bc)bc.classList.add('ring');},50);
  burstParticles();
  document.getElementById('ecm-name').textContent='確認完了';
  const tel=document.getElementById('ecm-timer');tel.textContent='✓';tel.className='ecm-timer';tel.style.color='var(--green)';
  S.verified=true;
  const w=document.getElementById('ecw');w.classList.add('ok');w.style.cursor='default';
  document.getElementById('ecw-label').textContent='確認済み';
  document.getElementById('ecw-sub').textContent='WT*Rca™ VERIFIED';
  document.getElementById('submit-btn').disabled=false;
  setTimeout(()=>{ecClose();const _sc=document.getElementById('ec-success');if(_sc)_sc.style.display='none';tel.style.color='';tel.textContent='—';},2000);
}
function submitForm(){
  if(!S.verified){alert('まずCAPTCHAを完了してください');return;}
  const u=document.getElementById('username-inp').value.trim();
  if(!u){alert('ユーザーネームを入力してください');return;}
  document.getElementById('demo-card').style.display='none';
  document.getElementById('page-label').style.display='none';
  document.getElementById('docs-page').style.display='block';
  window.scrollTo({top:0,behavior:'smooth'});
}
function setStatus(t,m){const el=document.getElementById('ec-status');if(!t){el.className='ec-status';return;}el.className='ec-status '+t;el.textContent=m;if(t!=='err')setTimeout(()=>setStatus(''),2500);}
function clearStatus(){setStatus('');}
function shake(id){const el=document.getElementById(id);if(!el)return;el.classList.remove('shake');void el.offsetWidth;el.classList.add('shake');setTimeout(()=>el.classList.remove('shake'),400);}

// ══ C1 DISTORTED TEXT ══
const ABC='ABCDEFGHJKLMNPQRSTUVWXYZabcdefghjkmnpqrstuvwxyz23456789';
function initC1(){S.c1text=rndStr(7);drawC1();const i=document.getElementById('c1-in');i.value='';i.focus();i.onkeydown=e=>{if(e.key==='Enter')chkC1();};document.getElementById('c1-cv').onclick=()=>{
  S.c1text=rndStr(7);drawC1();setStatus('warn','-2秒ペナルティ');
  // Actually deduct 2s from timer
  const tel=document.getElementById('ecm-timer');let cur=parseInt(tel.textContent)||0;
  if(cur>2){tel.textContent=cur-2;}else{fail('タイムオーバー (リフレッシュペナルティ)');}
};}
function rndStr(n){return Array.from({length:n},()=>ABC[~~(Math.random()*ABC.length)]).join('');}
function drawC1(){
  const cv=document.getElementById('c1-cv');cv.width=cv.clientWidth||480;const W=cv.width,H=90;
  cv.style.animation='none';void cv.offsetWidth;cv.style.animation='chSlide 0.3s ease';
  const ctx=cv.getContext('2d');ctx.fillStyle='#f5f2ed';ctx.fillRect(0,0,W,H);
  ctx.strokeStyle='rgba(0,0,0,0.06)';ctx.lineWidth=1;
  for(let x=0;x<W;x+=12){ctx.beginPath();ctx.moveTo(x,0);ctx.lineTo(x,H);ctx.stroke();}
  for(let y=0;y<H;y+=12){ctx.beginPath();ctx.moveTo(0,y);ctx.lineTo(W,y);ctx.stroke();}
  for(let i=0;i<8;i++){ctx.beginPath();ctx.strokeStyle=`rgba(0,0,0,${0.03+Math.random()*0.07})`;ctx.lineWidth=1+Math.random();ctx.moveTo(Math.random()*W,Math.random()*H);ctx.bezierCurveTo(Math.random()*W,Math.random()*H,Math.random()*W,Math.random()*H,Math.random()*W,Math.random()*H);ctx.stroke();}
  for(let i=0;i<100;i++){ctx.fillStyle=`rgba(0,0,0,${0.04+Math.random()*0.09})`;ctx.fillRect(Math.random()*W,Math.random()*H,1.5,1.5);}
  const step=(W-40)/S.c1text.length;
  for(let i=0;i<S.c1text.length;i++){ctx.save();ctx.translate(22+step*i+step/2,H/2+6);ctx.rotate((Math.random()-0.5)*0.55);ctx.scale(0.8+Math.random()*0.45,0.7+Math.random()*0.5);const fs=22+~~(Math.random()*12);ctx.font=`${Math.random()>0.5?'bold ':''} ${fs}px 'IBM Plex Mono',monospace`;ctx.fillStyle=`rgba(0,0,0,${0.55+Math.random()*0.45})`;ctx.fillText(S.c1text[i],0,0);ctx.restore();}
  const id=ctx.getImageData(0,0,W,H),d=id.data,nd=new Uint8ClampedArray(d);
  for(let y=0;y<H;y++){const wx=Math.sin(y/5)*5;for(let x=0;x<W;x++){const sx=Math.round(x+wx);if(sx>=0&&sx<W){const si=(y*W+sx)*4,di=(y*W+x)*4;nd[di]=d[si];nd[di+1]=d[si+1];nd[di+2]=d[si+2];nd[di+3]=d[si+3];}}}
  ctx.putImageData(new ImageData(nd,W,H),0,0);
}
function chkC1(){if(document.getElementById('c1-in').value.trim()===S.c1text)goNext();else{shake('c1-in');fail('不正解 / '+S.c1text);}}

// ══ C2 CHAOS SHAPE GRID 6×6 ══
const SHAPES=['circle','square','triangle','diamond','cross','star','hex','arrow','pentagon','wave','ring','zigzag'];
function drawShape(ctx,type,cx,cy,r,color,rot){
  ctx.save();ctx.translate(cx,cy);if(rot)ctx.rotate(rot);
  ctx.fillStyle=color;ctx.strokeStyle=color;ctx.lineWidth=Math.max(1.5,r*0.2);
  ctx.beginPath();
  if(type==='circle'){ctx.arc(0,0,r,0,Math.PI*2);ctx.fill();}
  else if(type==='square'){ctx.fillRect(-r,-r,r*2,r*2);}
  else if(type==='triangle'){ctx.moveTo(0,-r);ctx.lineTo(r*.87,r*.5);ctx.lineTo(-r*.87,r*.5);ctx.closePath();ctx.fill();}
  else if(type==='diamond'){ctx.moveTo(0,-r);ctx.lineTo(r*.65,0);ctx.lineTo(0,r);ctx.lineTo(-r*.65,0);ctx.closePath();ctx.fill();}
  else if(type==='cross'){ctx.lineWidth=r*.5;ctx.moveTo(-r*.65,0);ctx.lineTo(r*.65,0);ctx.stroke();ctx.beginPath();ctx.moveTo(0,-r*.65);ctx.lineTo(0,r*.65);ctx.stroke();}
  else if(type==='star'){for(let k=0;k<5;k++){const a=-Math.PI/2+k*Math.PI*2/5,b=a+Math.PI/5;k===0?ctx.moveTo(r*Math.cos(a),r*Math.sin(a)):ctx.lineTo(r*Math.cos(a),r*Math.sin(a));ctx.lineTo(r*.4*Math.cos(b),r*.4*Math.sin(b));}ctx.closePath();ctx.fill();}
  else if(type==='hex'){for(let k=0;k<6;k++){const a=k*Math.PI/3;k===0?ctx.moveTo(r*Math.cos(a),r*Math.sin(a)):ctx.lineTo(r*Math.cos(a),r*Math.sin(a));}ctx.closePath();ctx.fill();}
  else if(type==='arrow'){ctx.moveTo(-r*.55,-r*.3);ctx.lineTo(r*.05,-r*.3);ctx.lineTo(r*.05,-r*.6);ctx.lineTo(r*.6,0);ctx.lineTo(r*.05,r*.6);ctx.lineTo(r*.05,r*.3);ctx.lineTo(-r*.55,r*.3);ctx.closePath();ctx.fill();}
  else if(type==='pentagon'){for(let k=0;k<5;k++){const a=-Math.PI/2+k*Math.PI*2/5;k===0?ctx.moveTo(r*Math.cos(a),r*Math.sin(a)):ctx.lineTo(r*Math.cos(a),r*Math.sin(a));}ctx.closePath();ctx.fill();}
  else if(type==='wave'){ctx.lineWidth=r*.35;for(let x=-r;x<=r;x+=1){const y=Math.sin(x/r*Math.PI*1.5)*r*.45;x===-r?ctx.moveTo(x,y):ctx.lineTo(x,y);}ctx.stroke();}
  else if(type==='ring'){ctx.arc(0,0,r,0,Math.PI*2);ctx.stroke();ctx.beginPath();ctx.arc(0,0,r*.5,0,Math.PI*2);ctx.stroke();}
  else if(type==='zigzag'){const pts=5;ctx.lineWidth=r*.3;for(let k=0;k<=pts;k++){const x=-r+k*(r*2/pts);const y=k%2===0?r*.5:-r*.5;k===0?ctx.moveTo(x,y):ctx.lineTo(x,y);}ctx.stroke();}
  ctx.restore();
}
function shapeJP(s){return{circle:'円',square:'正方形',triangle:'三角形',diamond:'菱形',cross:'十字',star:'星',hex:'六角形',arrow:'矢印',pentagon:'五角形',wave:'波',ring:'二重丸',zigzag:'ジグザグ'}[s]||s;}
function initC2(){
  const target=SHAPES[~~(Math.random()*SHAPES.length)];
  // Build similar decoys: shapes that look similar at first glance
  // For triangle: add rotated triangles (point down = diamond-ish)
  // Strategy: pick 2-3 "similar" shapes as main decoys
  const similar = getSimilar(target);
  const count=4+~~(Math.random()*3); // 4-6 targets
  const cells=Array.from({length:36},()=>{
    if(Math.random()<0.45&&similar.length>0){return similar[~~(Math.random()*similar.length)];} // similar decoy
    let s;do{s=SHAPES[~~(Math.random()*SHAPES.length)];}while(s===target);return s;
  });
  S.c2correct=[];
  const pos=[];while(pos.length<count){const p=~~(Math.random()*36);if(!pos.includes(p))pos.push(p);}
  pos.forEach(p=>{cells[p]=target;S.c2correct.push(p);});
  document.getElementById('c2-q').innerHTML=`<strong>「${shapeJP(target)}」</strong>をすべて選んでください。<br><small style="color:var(--dim)">似た図形（回転・縮小違い）が混在 / ${count}個あります</small>`;
  const g=document.getElementById('c2-grid');g.innerHTML='';
  cells.forEach((sh,i)=>{
    const cell=document.createElement('div');cell.className='ec-cell';cell.dataset.i=i;
    const sz=46;const cv=document.createElement('canvas');cv.width=sz;cv.height=sz;cv.style.pointerEvents='none';
    const ctx=cv.getContext('2d');ctx.fillStyle='#f5f2ed';ctx.fillRect(0,0,sz,sz);
    const scale=0.65+Math.random()*0.35;
    const rot=Math.random()*Math.PI*2; // full random rotation for all shapes
    const r=Math.round(sz*0.27*scale);
    const isT=S.c2correct.includes(i);
    const shade=isT?`rgba(26,24,37,${0.8+Math.random()*0.2})`:`rgba(${50+~~(Math.random()*100)},${50+~~(Math.random()*100)},${50+~~(Math.random()*100)},${0.45+Math.random()*0.45})`;
    drawShape(ctx,sh,sz/2,sz/2,r,shade,rot);
    cell.appendChild(cv);cell.onclick=()=>{cell.classList.toggle('sel');};cell.style.animation=`cellEntry 0.3s cubic-bezier(0.175,0.885,0.32,1.4) ${i*8}ms both`;g.appendChild(cell);
  });
}
function getSimilar(t){
  const map={circle:['ring'],square:['diamond','rectangle'],triangle:['diamond','pentagon'],diamond:['square','triangle'],cross:['star'],star:['cross','hex'],hex:['pentagon'],arrow:['triangle'],pentagon:['hex','triangle'],wave:['zigzag'],ring:['circle'],zigzag:['wave']};
  return (map[t]||[]).filter(s=>SHAPES.includes(s));
}
function chkC2(){
  const sel=[...document.querySelectorAll('#c2-grid .ec-cell.sel')].map(c=>+c.dataset.i).sort((a,b)=>a-b).join(',');
  if(sel===S.c2correct.slice().sort((a,b)=>a-b).join(','))goNext();else fail('選択が違います');
}

// ══ C3 SLIDER ══
function initC3(){
  const m=12+~~(Math.random()*78);S.c3target={min:m,max:m+5};S.c3val=0;
  document.getElementById('c3-zone').style.left=m+'%';document.getElementById('c3-zone').style.width='5%';updSlider3('c3',0);
  mkSlider('c3-track','c3val','c3drag');
}
function updSlider3(id,v){document.getElementById(id+'-fill').style.width=v+'%';document.getElementById(id+'-thumb').style.left=v+'%';}
function mkSlider(trackId,valKey,dragKey){
  const tr=document.getElementById(trackId);
  const mv=e=>{const r=tr.getBoundingClientRect();const cx=(e.touches?e.touches[0].clientX:e.clientX)-r.left;S[valKey]=Math.max(0,Math.min(100,(cx/r.width)*100));const pfx=trackId.replace('-track','');updSlider3(pfx,S[valKey]);};
  tr.onmousedown=e=>{S[dragKey]=true;mv(e);};tr.ontouchstart=e=>{S[dragKey]=true;mv(e);e.preventDefault();};
}
const _SIDS=['c3','c21a','c21b','c34a','c34b','c34c'];
function _sliderMove(cx){_SIDS.forEach(id=>{if(S[id+'drag']){const tr=document.getElementById(id+'-track');if(tr){const r=tr.getBoundingClientRect();S[id+'val']=Math.max(0,Math.min(100,((cx-r.left)/r.width)*100));updSlider3(id,S[id+'val']);}}});}
document.addEventListener('mousemove',e=>_sliderMove(e.clientX));
document.addEventListener('touchmove',e=>{if(e.touches&&e.touches.length)_sliderMove(e.touches[0].clientX);},{passive:true});
document.addEventListener('mouseup',()=>{_SIDS.forEach(id=>S[id+'drag']=false);});
document.addEventListener('touchend',()=>{_SIDS.forEach(id=>S[id+'drag']=false);});
function chkC3(){if(S.c3val>=S.c3target.min&&S.c3val<=S.c3target.max)goNext();else fail('ゾーンに合っていません');}

// ══ C4 REVERSE SEQUENCE ══
function initC4(){
  const seq=Array.from({length:7},()=>~~(Math.random()*10));S.c4answer=[...seq].reverse();S.c4entered=[];S.c4seq=seq;
  document.getElementById('c4-entered').textContent='—';drawSeq4(false);S.c4t=setTimeout(()=>drawSeq4(true),3000);
  const kp=document.getElementById('c4-keys');kp.innerHTML='';
  for(let n=0;n<=9;n++){const b=document.createElement('button');b.className='ec-key';b.textContent=n;b.onclick=()=>{if(S.c4entered.length>=S.c4answer.length)return;b.style.transform='scale(0.88)';setTimeout(()=>b.style.transform='',120);S.c4entered.push(n);updSeq4();if(S.c4entered.length===S.c4answer.length)chkC4();};kp.appendChild(b);}
  const bk=document.createElement('button');bk.className='ec-key';bk.textContent='⌫';bk.style.color='var(--accent)';bk.onclick=()=>{S.c4entered.pop();updSeq4();};kp.appendChild(bk);
}
function drawSeq4(hidden){
  if(!S.c4seq)return; // guard: seq may have been cleared by cleanupAll
  const cv=document.getElementById('c4-cv');if(!cv)return;
  cv.width=cv.clientWidth||460;const W=cv.width,H=68;
  const ctx=cv.getContext('2d');ctx.fillStyle='#f5f2ed';ctx.fillRect(0,0,W,H);
  if(hidden){
    const nums=[...S.c4seq]; // copy before nulling
    const off=document.createElement('canvas');off.width=W;off.height=H;const oc=off.getContext('2d');
    oc.fillStyle='#f5f2ed';oc.fillRect(0,0,W,H);oc.save();oc.filter='blur(9px)';oc.font='bold 28px IBM Plex Mono,monospace';oc.textAlign='center';oc.textBaseline='middle';oc.fillStyle='rgba(0,0,0,0.55)';
    const step=W/(nums.length+1);nums.forEach((n,i)=>oc.fillText(n,(i+1)*step,H/2));oc.restore();
    ctx.putImageData(oc.getImageData(0,0,W,H),0,0);
    for(let i=0;i<600;i++){ctx.fillStyle=`rgba(245,242,237,${0.3+Math.random()*0.5})`;ctx.fillRect(Math.random()*W,Math.random()*H,1+Math.random()*3,1+Math.random()*3);}
    S.c4seq=null;
  }else{
    const nums=S.c4seq;const step=W/(nums.length+1);
    ctx.font='bold 26px IBM Plex Mono,monospace';ctx.textAlign='center';ctx.textBaseline='middle';ctx.fillStyle='#1a1825';
    nums.forEach((n,i)=>ctx.fillText(n,(i+1)*step,H/2));
  }
}
function updSeq4(){document.getElementById('c4-entered').textContent=S.c4entered.length?S.c4entered.join(' '):'—';}
function chkC4(){if(S.c4entered.every((v,i)=>v===S.c4answer[i]))goNext();else fail('逆順が違います');}

// ══ C5 MATH ══
function initC5(){
  const a=5+~~(Math.random()*20),b=2+~~(Math.random()*10),c=1+~~(Math.random()*5),d=2+~~(Math.random()*8);
  S.c5answer=(a*b)-(c*d)+Math.floor(Math.sqrt(a*b));
  document.getElementById('c5-math').textContent=`( ${a} × ${b} ) − ( ${c} × ${d} ) + ⌊√(${a}×${b})⌋\n= ?`;
  const i=document.getElementById('c5-in');i.value='';i.focus();i.onkeydown=e=>{if(e.key==='Enter')chkC5();};
}
function chkC5(){if(+document.getElementById('c5-in').value===S.c5answer)goNext();else{shake('c5-in');fail(`不正解 / ${S.c5answer}`);}}

// ══ C6 STROOP ══
const COLS=[{n:'あか',h:'#d63031'},{n:'あお',h:'#0984e3'},{n:'きいろ',h:'#f9ca24'},{n:'みどり',h:'#00b894'},{n:'むらさき',h:'#6c5ce7'},{n:'くろ',h:'#2d3436'},{n:'オレンジ',h:'#e17055'},{n:'みずいろ',h:'#74b9ff'}];
function initC6(){
  S.c6sel=-1;const ti=~~(Math.random()*COLS.length);const tg=COLS[ti];
  let di;do{di=~~(Math.random()*COLS.length);}while(di===ti);
  const sw=document.getElementById('c6-word');sw.textContent=tg.n;sw.style.color=COLS[di].h;sw.style.animation='none';void sw.offsetWidth;sw.style.animation='stroopIn 0.4s cubic-bezier(0.175,0.885,0.32,1.4)';
  let opts=[...COLS].sort(()=>Math.random()-0.5).slice(0,6);
  if(!opts.find(c=>c.n===tg.n))opts[~~(Math.random()*opts.length)]=tg;
  S.c6correct=opts.findIndex(c=>c.n===tg.n);
  const row=document.getElementById('c6-swatches');row.innerHTML='';
  opts.forEach((col,i)=>{const s=document.createElement('div');s.className='ec-swatch';s.style.background=col.h;const lb=document.createElement('div');lb.className='ec-swatch-label';lb.textContent=col.n;s.appendChild(lb);s.onclick=()=>{document.querySelectorAll('.ec-swatch').forEach(x=>{x.classList.remove('sel');x.style.transform='';});s.classList.add('sel');s.style.transform='scale(1.1)';S.c6sel=i;};row.appendChild(s);});
}
function chkC6(){if(S.c6sel<0){setStatus('warn','色を選んでください');return;}if(S.c6sel===S.c6correct)goNext();else fail('ストループに引っかかった');}

// ══ C7 DIAL ══
function initC7(){
  S.c7angle=Math.random()*360;const tgt=20+~~(Math.random()*320);S.c7target={min:(tgt-12+360)%360,max:(tgt+12)%360};
  document.getElementById('c7-target-label').textContent=`目標: ${tgt}° ± 12°`;updDial();
  const dial=document.getElementById('c7-dial');let last=null;
  const ga=e=>{const r=dial.getBoundingClientRect();const cx=(e.touches?e.touches[0].clientX:e.clientX)-(r.left+r.width/2);const cy=(e.touches?e.touches[0].clientY:e.clientY)-(r.top+r.height/2);return(Math.atan2(cy,cx)*180/Math.PI+90+360)%360;};
  const onMM=e=>{if(!S.c7drag)return;const a=ga(e);S.c7angle=(S.c7angle+(a-last)+360)%360;last=a;updDial();};
  const onMU=()=>{S.c7drag=false;const dl=document.getElementById('c7-dial');if(dl)dl.classList.remove('dragging');};
  const onTM=e=>{if(!S.c7drag)return;const a=ga(e);S.c7angle=(S.c7angle+(a-last)+360)%360;last=a;updDial();e.preventDefault();};
  const onTE=()=>{S.c7drag=false;};
  document.addEventListener('mousemove',onMM);document.addEventListener('mouseup',onMU);
  document.addEventListener('touchmove',onTM,{passive:false});document.addEventListener('touchend',onTE);
  S.c7cleanup=()=>{document.removeEventListener('mousemove',onMM);document.removeEventListener('mouseup',onMU);document.removeEventListener('touchmove',onTM);document.removeEventListener('touchend',onTE);S.c7cleanup=null;};
  dial.onmousedown=e=>{S.c7drag=true;last=ga(e);dial.classList.add('dragging');};
  dial.ontouchstart=e=>{S.c7drag=true;last=ga(e);e.preventDefault();};
}
function updDial(){const a=S.c7angle,rad=(a-90)*Math.PI/180,r=54;const h=document.getElementById('c7-handle');h.style.left=(50+r*Math.cos(rad))+'%';h.style.top=(50+r*Math.sin(rad))+'%';h.style.transform='translate(-50%,-50%)';document.getElementById('c7-hint').textContent=`現在: ${Math.round(a)}°`;}
function chkC7(){const a=S.c7angle,{min,max}=S.c7target;const ok=min<=max?a>=min&&a<=max:(a>=min||a<=max);if(ok)goNext();else fail('角度がずれています');}

// ══ C8 MORSE ══
const MORSE={'0':'-----','1':'.----','2':'..---','3':'...--','4':'....-','5':'.....','6':'-....','7':'--...','8':'---..','9':'----.'};
function initC8(){
  const num=10+~~(Math.random()*90);const morseEl=document.getElementById('c8-morse');morseEl.textContent=String(num).split('').map(c=>MORSE[c]).join('  /  ');morseEl.style.animation='none';void morseEl.offsetWidth;morseEl.style.animation='morseIn 0.5s ease';S.c8answer=String(num);
  const opts=new Set([num]);while(opts.size<6)opts.add(10+~~(Math.random()*90));
  const arr=[...opts].sort(()=>Math.random()-0.5);const cont=document.getElementById('c8-opts');cont.innerHTML='';
  arr.forEach(n=>{const b=document.createElement('button');b.className='ec-morse-btn';b.textContent=n;b.onclick=()=>{if(String(n)===S.c8answer)goNext();else fail('モールス解読ミス');};cont.appendChild(b);});
}

// ══ C9 COORDINATE CLICK ══
function initC9(){
  S.c9click=null;const cv=document.getElementById('c9-cv');cv.width=cv.clientWidth||480;const W=cv.width,H=200;
  const tx=50+~~(Math.random()*(W-100)),ty=50+~~(Math.random()*(H-100));S.c9target={x:tx,y:ty};drawCoord(cv,tx,ty,null);
  cv.onclick=e=>{const r=cv.getBoundingClientRect();S.c9click={x:(e.clientX-r.left)*(W/r.width),y:(e.clientY-r.top)*(H/r.height)};drawCoord(cv,tx,ty,S.c9click);document.getElementById('c9-hint').textContent=`クリック (${~~S.c9click.x},${~~S.c9click.y}) 目標 (${tx},${ty})`;cv.style.animation='none';void cv.offsetWidth;cv.style.animation='chSlide 0.15s ease';};
}
function drawCoord(cv,tx,ty,click){
  const W=cv.width,H=cv.height,ctx=cv.getContext('2d');ctx.fillStyle='#f5f2ed';ctx.fillRect(0,0,W,H);
  ctx.strokeStyle='rgba(0,0,0,0.07)';ctx.lineWidth=1;for(let x=0;x<W;x+=20){ctx.beginPath();ctx.moveTo(x,0);ctx.lineTo(x,H);ctx.stroke();}for(let y=0;y<H;y+=20){ctx.beginPath();ctx.moveTo(0,y);ctx.lineTo(W,y);ctx.stroke();}
  ctx.strokeStyle='rgba(0,0,0,0.2)';ctx.lineWidth=1.5;ctx.beginPath();ctx.moveTo(30,0);ctx.lineTo(30,H);ctx.stroke();ctx.beginPath();ctx.moveTo(0,H-20);ctx.lineTo(W,H-20);ctx.stroke();
  ctx.fillStyle='rgba(0,0,0,0.3)';ctx.font='8px IBM Plex Mono,monospace';for(let x=50;x<W;x+=40)ctx.fillText(x-30,x-4,H-6);for(let y=20;y<H-20;y+=40)ctx.fillText(H-20-y,4,y+4);
  for(let i=0;i<18;i++){const px=40+Math.random()*(W-60),py=10+Math.random()*(H-40);ctx.beginPath();ctx.arc(px,py,3,0,Math.PI*2);ctx.fillStyle='rgba(9,132,227,0.35)';ctx.fill();}
  const s=9;ctx.strokeStyle='#d63031';ctx.lineWidth=2.5;ctx.beginPath();ctx.moveTo(tx-s,ty-s);ctx.lineTo(tx+s,ty+s);ctx.stroke();ctx.beginPath();ctx.moveTo(tx+s,ty-s);ctx.lineTo(tx-s,ty+s);ctx.stroke();
  if(click){ctx.beginPath();ctx.arc(click.x,click.y,5,0,Math.PI*2);ctx.fillStyle='#00b894';ctx.fill();ctx.strokeStyle='rgba(0,184,148,0.25)';ctx.lineWidth=10;ctx.beginPath();ctx.arc(click.x,click.y,11,0,Math.PI*2);ctx.stroke();}
}
function chkC9(){if(!S.c9click){setStatus('warn','クリックしてください');return;}const dx=S.c9click.x-S.c9target.x,dy=S.c9click.y-S.c9target.y;if(Math.sqrt(dx*dx+dy*dy)<=12)goNext();else fail('ずれています (±12px)');}

// ══ C10 SORT ══
function initC10(){
  const nums=Array.from({length:5},()=>1+~~(Math.random()*99)).sort(()=>Math.random()-0.5);S.c10answer=[...nums].sort((a,b)=>a-b);S.c10slots=Array(5).fill(null);
  const sl=document.getElementById('c10-slots');sl.innerHTML='';for(let i=0;i<5;i++){const s=document.createElement('div');s.className='ec-sort-slot';s.dataset.i=i;s.textContent=i+1;sl.appendChild(s);}
  const it=document.getElementById('c10-items');it.innerHTML='';
  nums.forEach((n,i)=>{const el=document.createElement('div');el.className='ec-sort-num';el.textContent=n;el.onclick=()=>{if(el.classList.contains('used'))return;const si=S.c10slots.findIndex(v=>v===null);if(si<0)return;S.c10slots[si]=n;el.classList.add('used');const slot=document.querySelector(`.ec-sort-slot[data-i="${si}"]`);if(slot){slot.textContent=n;slot.classList.add('filled');slot.style.animation='none';void slot.offsetWidth;slot.style.animation='slotPop 0.25s cubic-bezier(0.175,0.885,0.32,1.6)';}};it.appendChild(el);});
}
function resetC10(){
  S.c10slots=Array(5).fill(null);
  document.querySelectorAll('#c10-slots .ec-sort-slot').forEach((s,i)=>{s.textContent=i+1;s.classList.remove('filled');});
  document.querySelectorAll('#c10-items .ec-sort-num').forEach(el=>el.classList.remove('used'));
}
function chkC10(){if(S.c10slots.includes(null)){setStatus('warn','すべて選んでください');return;}if(S.c10slots.every((v,i)=>v===S.c10answer[i]))goNext();else fail('並び順が違います');}

// ══ C11 REACTION ══
function killReact(){if(S.c11timers){S.c11timers.forEach(t=>clearTimeout(t));S.c11timers=[];}clearTimeout(S.c11t);S.c11t=null;}
function drawReact(color,label){
  if(S.c11done&&!label)return; // don't draw fakes after done
  const cv=document.getElementById('c11-cv');if(!cv||!cv.isConnected)return;
  if(!cv._initW||!cv.width){cv.width=cv.clientWidth||460;cv._initW=true;}
  const W=cv.width||460,H=118;
  const ctx=cv.getContext('2d');if(!ctx)return;
  ctx.fillStyle=color;ctx.fillRect(0,0,W,H);
  if(label){ctx.fillStyle='rgba(255,255,255,0.85)';ctx.font='bold 14px IBM Plex Mono,monospace';ctx.textAlign='center';ctx.textBaseline='middle';ctx.fillText(label,W/2,H/2);}
}
function initC11(){S.c11red=false;S.c11done=false;S.c11timers=[];killReact();const _c11cv=document.getElementById('c11-cv');if(_c11cv)_c11cv._initW=false;drawReact('#f5f2ed','');document.getElementById('c11-hint').textContent='待機中...';
  const fakes=~~(Math.random()*4)+1;let delay=700+~~(Math.random()*1400);
  for(let f=0;f<fakes;f++){const fd=delay;const _t1=setTimeout(()=>{if(S.c11done)return;drawReact('rgba(214,48,49,0.18)','');const _t2=setTimeout(()=>{if(!S.c11done)drawReact('#f5f2ed','');},120);if(S.c11timers)S.c11timers.push(_t2);},fd);if(S.c11timers)S.c11timers.push(_t1);delay+=700+~~(Math.random()*1400);}
  S.c11t=setTimeout(()=>{if(S.c11done)return;S.c11red=true;drawReact('#d63031','CLICK NOW');const _h11=document.getElementById('c11-hint');if(_h11&&_h11.isConnected)_h11.textContent='今すぐ！';},delay);
}
function reactClick(){if(S.c11done)return;S.c11done=true;killReact();if(S.c11red)goNext();else fail('早すぎ');}

// ══ C12 BINARY ══
function initC12(){
  const n=1+~~(Math.random()*127);S.c12answer=n;document.getElementById('c12-bin').textContent=n.toString(2).padStart(7,'0');
  const opts=new Set([n]);while(opts.size<8)opts.add(1+~~(Math.random()*127));
  const arr=[...opts].sort(()=>Math.random()-0.5);const cont=document.getElementById('c12-opts');cont.innerHTML='';
  arr.forEach(v=>{const b=document.createElement('button');b.className='ec-mc-btn';b.textContent=v;b.onclick=()=>{if(v===S.c12answer){b.style.background='var(--green)';b.style.color='white';setTimeout(()=>goNext(),180);}else{b.style.background='var(--accent)';b.style.color='white';setTimeout(()=>{b.style.background='';b.style.color='';},300);fail(`不正解 / ${S.c12answer}`);}};cont.appendChild(b);});
}

// ══ C13 HEX COLOR ══
function initC13(){
  S.c13sel=-1;const r=~~(Math.random()*200)+20,g=~~(Math.random()*200)+20,b=~~(Math.random()*200)+20;
  const hex=`#${r.toString(16).padStart(2,'0')}${g.toString(16).padStart(2,'0')}${b.toString(16).padStart(2,'0')}`.toUpperCase();
  document.getElementById('c13-hex').textContent=hex;
  const options=[[r,g,b]];while(options.length<5){const dr=(Math.random()-.5)*80,dg=(Math.random()-.5)*80,db=(Math.random()-.5)*80;const nr=Math.max(0,Math.min(255,r+dr)),ng=Math.max(0,Math.min(255,g+dg)),nb=Math.max(0,Math.min(255,b+db));if(Math.abs(nr-r)+Math.abs(ng-g)+Math.abs(nb-b)>25)options.push([nr,ng,nb]);}
  options.sort(()=>Math.random()-0.5);S.c13correct=options.findIndex(o=>o[0]===r&&o[1]===g&&o[2]===b);
  const row=document.getElementById('c13-swatches');row.innerHTML='';
  options.forEach((rgb,i)=>{const sw=document.createElement('div');sw.className='ec-hex-swatch';sw.style.background=`rgb(${rgb[0]},${rgb[1]},${rgb[2]})`;sw.onclick=()=>{document.querySelectorAll('.ec-hex-swatch').forEach(x=>{x.classList.remove('sel');});sw.classList.add('sel');S.c13sel=i;};row.appendChild(sw);});
}
function chkC13(){if(S.c13sel<0){setStatus('warn','色を選んでください');return;}if(S.c13sel===S.c13correct)goNext();else fail('HEXカラーが一致しません');}

// ══ C14 WAVEFORM ══
function drawWave(cv,freq,amp,phase){
  cv.width=cv.clientWidth||200;const W=cv.width,H=cv.height;const ctx=cv.getContext('2d');
  ctx.fillStyle='#f5f2ed';ctx.fillRect(0,0,W,H);ctx.strokeStyle='rgba(0,0,0,0.1)';ctx.lineWidth=1;
  for(let y=H/4;y<H;y+=H/4){ctx.beginPath();ctx.moveTo(0,y);ctx.lineTo(W,y);ctx.stroke();}
  ctx.strokeStyle='#1a1825';ctx.lineWidth=2;ctx.beginPath();
  for(let x=0;x<W;x++){const t=x/W*Math.PI*2*freq+phase;const y=H/2-Math.sin(t)*amp*(H/2-8);x===0?ctx.moveTo(x,y):ctx.lineTo(x,y);}ctx.stroke();
}
function initC14(){
  S.c14sel=-1;const freq=1+~~(Math.random()*4),amp=0.4+Math.random()*0.55,phase=Math.random()*Math.PI*2;S.c14p={freq,amp,phase};
  const tcv=document.getElementById('c14-target');tcv.width=tcv.clientWidth||460;drawWave(tcv,freq,amp,phase);
  const oc=document.getElementById('c14-opts');oc.innerHTML='';
  const variants=[[freq,amp,phase]];
  while(variants.length<4){const wf=Math.max(1,freq+(~~(Math.random()*2)+1)*(Math.random()>.5?1:-1));const wa=Math.max(.2,Math.min(.95,amp+(Math.random()-.5)*.4));const wp=(phase+Math.PI/2+Math.random()*Math.PI)%(Math.PI*2);variants.push([wf,wa,wp]);}
  // Tag correct answer by index BEFORE shuffle
  const correctIdx=0;
  const shuffled14=variants.map((p,i)=>({p,isCorrect:i===correctIdx})).sort(()=>Math.random()-0.5);
  S.c14correct=shuffled14.findIndex(x=>x.isCorrect);
  const sortedVariants=shuffled14.map(x=>x.p);
  sortedVariants.forEach((p,i)=>{
    const wrap=document.createElement('div');wrap.className='ec-wave-opt';wrap.dataset.i=i;
    const cv=document.createElement('canvas');cv.height=70;cv.style.cssText='display:block;width:100%;height:70px;';
    wrap.appendChild(cv);wrap.onclick=()=>{document.querySelectorAll('.ec-wave-opt').forEach(x=>x.classList.remove('sel'));wrap.classList.add('sel');S.c14sel=i;};
    oc.appendChild(wrap);setTimeout(()=>{cv.width=cv.clientWidth||220;drawWave(cv,p[0],p[1],p[2]);},20+i*15);
  });
}
function chkC14(){if(S.c14sel<0){setStatus('warn','選んでください');return;}if(S.c14sel===S.c14correct)goNext();else fail('波形が一致しません');}

// ══ C15 SHAPE COUNT ══
function initC15(){
  const target=SHAPES[~~(Math.random()*SHAPES.length)];
  const cv=document.getElementById('c15-cv');cv.width=cv.clientWidth||460;const W=cv.width,H=200;
  const ctx=cv.getContext('2d');ctx.fillStyle='#f5f2ed';ctx.fillRect(0,0,W,H);
  const total=18+~~(Math.random()*8);const targetCount=3+~~(Math.random()*5);
  document.getElementById('c15-q').innerHTML=`<strong>「${shapeJP(target)}」</strong>が何個ありますか？<br><small style="color:var(--dim)">回転・縮小・重なりあり。全${total}個の中から</small>`;
  // Build cell list: guarantee exactly targetCount targets
  const cells15=[];
  const targetPositions=new Set();while(targetPositions.size<targetCount)targetPositions.add(~~(Math.random()*total));
  for(let i=0;i<total;i++){
    const isT=targetPositions.has(i);
    const sh=isT?target:SHAPES.filter(s=>s!==target)[~~(Math.random()*(SHAPES.length-1))];
    cells15.push({sh,x:15+Math.random()*(W-30),y:15+Math.random()*(H-30),r:7+Math.random()*15,rot:Math.random()*Math.PI*2});
  }
  cells15.forEach(({sh,x,y,r,rot})=>drawShape(ctx,sh,x,y,r,`rgba(26,24,37,${0.35+Math.random()*0.6})`,rot));
  S.c15answer=targetCount;const opts=new Set([targetCount]);while(opts.size<8){const v=Math.max(1,targetCount+~~((Math.random()-.5)*8));opts.add(v);}
  const arr=[...opts].sort((a,b)=>a-b);const cont=document.getElementById('c15-opts');cont.innerHTML='';
  arr.forEach(v=>{const b=document.createElement('button');b.className='ec-mc-btn';b.textContent=v;b.onclick=()=>{if(v===S.c15answer)goNext();else fail(`不正解 / ${S.c15answer}`);};cont.appendChild(b);});
}

// ══ C16 PATTERN MEMORY ══
function initC16(){
  if(S.c16t){clearTimeout(S.c16t);S.c16t=null;}
  const size=25;S.c16pattern=Array.from({length:size},()=>Math.random()>.55?1:0);S.c16input=Array(size).fill(0);S.c16phase='show';
  document.getElementById('c16-phase').textContent='3秒間記憶してください';
  document.getElementById('c16-btn').style.display='none';
  const g=document.getElementById('c16-grid');g.innerHTML='';
  S.c16pattern.forEach((v,i)=>{const c=document.createElement('div');c.className='ec-mem-cell '+(v?'on':'off');c.style.animationDelay=`${i*20}ms`;c.style.animation=`cellEntry 0.3s cubic-bezier(0.175,0.885,0.32,1.4) ${i*20}ms both`;c.dataset.i=i;g.appendChild(c);});
  S.c16t=setTimeout(()=>{
    S.c16t=null;if(S.c16phase!=='show')return;
    const _p16=document.getElementById('c16-phase');const _b16=document.getElementById('c16-btn');
    if(!_p16||!_p16.isConnected)return; // challenge no longer active
    S.c16phase='input';_p16.textContent='再現してください（クリックでオン/オフ）';
    _b16.style.display='block';
    g.innerHTML='';S.c16input=Array(size).fill(0);
    for(let i=0;i<size;i++){const c=document.createElement('div');c.className='ec-mem-cell off inp';c.onclick=()=>{S.c16input[i]=S.c16input[i]?0:1;c.classList.toggle('sel',!!S.c16input[i]);c.classList.toggle('off',!S.c16input[i]);};g.appendChild(c);}
  },3000);
}
function chkC16(){
  if(S.c16pattern.every((v,i)=>v===S.c16input[i]))goNext();else fail('パターンが一致しません');
}

// ══ C17 COUNT TAP ══
function initC17(){
  S.c17target=8+~~(Math.random()*20);S.c17count=0;
  document.getElementById('c17-count').textContent='0';document.getElementById('c17-target-label').textContent=`目標: ${S.c17target} 回`;
}
function addRipple(el,e){
  const r=el.getBoundingClientRect();const rip=document.createElement('span');
  rip.className='ec-tap-ripple';rip.style.left=(e.clientX-r.left-5)+'px';rip.style.top=(e.clientY-r.top-5)+'px';
  el.appendChild(rip);setTimeout(()=>rip.remove(),600);
}
function tapIt(e){
  S.c17count++;
  const el=document.getElementById('c17-count');
  el.textContent=S.c17count;
  el.style.animation='none';void el.offsetWidth;el.style.animation='countPop 0.18s cubic-bezier(0.175,0.885,0.32,1.6)';
  if(e)addRipple(document.getElementById('c17-tap'),e);
}
function chkC17(){if(S.c17count===S.c17target)goNext();else fail(`${S.c17count}回 — 目標は${S.c17target}回`);}

// ══ C18 SIMON ══
const SIMON_COLS=['#d63031','#0984e3','#00b894','#fdcb6e'];
const SIMON_JP=['赤','青','緑','黄'];
function clearC18(){if(S.c18timers){S.c18timers.forEach(t=>clearTimeout(t));S.c18timers=[];}}
function initC18(){
  clearC18();S.c18timers=[];
  const seqLen=4+~~(Math.random()*3);S.c18seq=Array.from({length:seqLen},()=>~~(Math.random()*4));S.c18input=[];S.c18phase='show';
  document.getElementById('c18-phase').textContent='シーケンス再生中...';document.getElementById('c18-progress').textContent='—';
  const g=document.getElementById('c18-grid');g.innerHTML='';
  SIMON_COLS.forEach((col,i)=>{const b=document.createElement('button');b.className='ec-simon-btn';b.style.background=col;b.style.filter='brightness(0.5)';b.dataset.i=i;const lb=document.createElement('div');lb.className='ec-simon-label';lb.textContent=SIMON_JP[i];b.appendChild(lb);g.appendChild(b);});
  // play sequence
  let delay=800;S.c18seq.forEach((idx,j)=>{const _t=setTimeout(()=>{const btns=[...document.querySelectorAll('.ec-simon-btn')];if(!btns[idx])return;btns[idx].style.filter='brightness(1.5)';btns[idx].style.transform='scale(1.04)';btns[idx].style.boxShadow='0 0 20px rgba(255,255,255,0.4)';const _t2=setTimeout(()=>{if(btns[idx]){btns[idx].style.filter='brightness(0.5)';btns[idx].style.transform='';btns[idx].style.boxShadow='';}},350);S.c18timers.push(_t2);},delay);S.c18timers.push(_t);delay+=600;});
  const _tFinal=setTimeout(()=>{
    if(S.c18phase!=='show')return;
    S.c18phase='input';document.getElementById('c18-phase').textContent='同じ順に押してください';
    document.querySelectorAll('.ec-simon-btn').forEach(b=>{b.style.filter='brightness(0.8)';b.onclick=()=>{
      if(S.c18phase!=='input'||b.dataset.pressed)return;b.dataset.pressed='1';const idx=+b.dataset.i;S.c18input.push(idx);b.style.filter='brightness(1.4)';const _bt=setTimeout(()=>{if(b.isConnected&&S.c18phase==='input')b.style.filter='brightness(0.8)';delete b.dataset.pressed;},200);S.c18timers.push(_bt);
      const prog=document.getElementById('c18-progress');if(prog&&prog.isConnected)prog.textContent=S.c18input.map(i=>SIMON_JP[i]).join(' → ');
      const pos=S.c18input.length-1;if(S.c18input[pos]!==S.c18seq[pos]){fail('シーケンスが違います');return;}
      if(S.c18input.length===S.c18seq.length)goNext();
    };});
  },delay+400);
  S.c18timers.push(_tFinal);
}

// ══ C19 LOGIC PUZZLE ══
const LOGIC_Q=[
  {q:'AはBより大きい。BはCより大きい。最も小さいのは？',opts:['A','B','C','わからない'],ans:'C'},
  {q:'全員が正直者か嘘つきである。\nアは「イは嘘つきだ」と言った。\nイは「アは正直者だ」と言った。\nアは正直者か？',opts:['正直者','嘘つき','どちらでもない','判断不能'],ans:'嘘つき'},
  {q:'赤・青・緑の3つの箱がある。\n「金貨は赤か青に入っている」が嘘。\n「金貨は赤に入っている」が嘘。\n金貨はどこ？',opts:['赤','青','緑','箱の外'],ans:'緑'},
  {q:'5人が一列に並んでいる。\nAはBの直後。CはDの前。EはAの後。\n1番前は誰？',opts:['A','B','C','D'],ans:'D'},
  {q:'「この文は嘘だ」は真か偽か？',opts:['真','偽','どちらでもない','判断不能'],ans:'判断不能'},
  {q:'すべての猫は動物。一部の動物は白い。\n白い猫は必ず存在する？',opts:['必ず存在する','存在しない可能性がある','存在しない','わからない'],ans:'存在しない可能性がある'},
];
function initC19(){
  const q=LOGIC_Q[~~(Math.random()*LOGIC_Q.length)];S.c19answer=q.ans;
  document.getElementById('c19-logic').textContent=q.q;
  const cont=document.getElementById('c19-opts');cont.innerHTML='';
  q.opts.sort(()=>Math.random()-0.5).forEach(o=>{const b=document.createElement('button');b.className='ec-mc-btn';b.textContent=o;b.onclick=()=>{if(o===S.c19answer)goNext();else fail(`不正解 / 正解: ${S.c19answer}`);};cont.appendChild(b);});
}

// ══ C20 TYPE OUT ══
const TYPE_CHARS='ABCDEFGHJKLMNPQRSTUVWXYZabcdefghjkmnpqrstuvwxyz0123456789!@#$%&*?';
function initC20(){
  S.c20target=Array.from({length:9},()=>TYPE_CHARS[~~(Math.random()*TYPE_CHARS.length)]).join('');
  document.getElementById('c20-target').textContent=S.c20target;
  const i=document.getElementById('c20-in');i.value='';i.focus();i.onkeydown=e=>{if(e.key==='Enter')chkC20();};
}
function chkC20(){if(document.getElementById('c20-in').value===S.c20target)goNext();else{shake('c20-in');fail('タイプミス / 正解: '+S.c20target);}}

// ══ C21 DOUBLE SLIDER ══
function initC21(){
  const am=10+~~(Math.random()*78);S.c21atarget={min:am,max:am+5};S.c21aval=0;
  const bm=10+~~(Math.random()*78);S.c21btarget={min:bm,max:bm+5};S.c21bval=0;
  document.getElementById('c21a-zone').style.left=am+'%';document.getElementById('c21a-zone').style.width='5%';
  document.getElementById('c21b-zone').style.left=bm+'%';document.getElementById('c21b-zone').style.width='5%';
  updSlider3('c21a',0);updSlider3('c21b',0);
  mkSlider('c21a-track','c21aval','c21adrag');mkSlider('c21b-track','c21bval','c21bdrag');
}
function chkC21(){
  const aOk=S.c21aval>=S.c21atarget.min&&S.c21aval<=S.c21atarget.max;
  const bOk=S.c21bval>=S.c21btarget.min&&S.c21bval<=S.c21btarget.max;
  if(aOk&&bOk)goNext();else fail(!aOk&&!bOk?'A・Bとも外れ':`${!aOk?'A':'B'}が外れ`);
}

// ══ C22 SEQUENCE NEXT ══
function initC22(){
  const seqs=[
    ()=>{const a=~~(Math.random()*5)+1,s=~~(Math.random()*5)+2;const arr=Array.from({length:5},(_,i)=>a+s*i);return{arr,ans:arr[arr.length-1]+s,type:'等差'};},
    ()=>{const a=~~(Math.random()*3)+2,r=~~(Math.random()*2)+2;const arr=Array.from({length:4},(_,i)=>a*Math.pow(r,i));return{arr,ans:arr[arr.length-1]*r,type:'等比'};},
    ()=>{const arr=[1,1];while(arr.length<6)arr.push(arr[arr.length-1]+arr[arr.length-2]);const s=~~(Math.random()*2)+1;return{arr:arr.slice(0,5).map(v=>v*s),ans:arr[5]*s,type:'フィボナッチ系'};},
    ()=>{const a=~~(Math.random()*3)+1;const arr=Array.from({length:5},(_,i)=>a*(i+1)*(i+1));return{arr,ans:a*36,type:'2乗'};},
  ];
  const {arr,ans}=seqs[~~(Math.random()*seqs.length)]();S.c22answer=ans;
  document.getElementById('c22-seq').textContent=arr.join(' , ') + ' , ?';
  const opts=new Set([ans]);let _g22=0;const _spread=Math.max(10,Math.abs(ans)*0.4);while(opts.size<4&&_g22++<500){const d=(~~((Math.random()-.5)*_spread*2))||1;opts.add(ans+d);}
  const a=[...opts].sort(()=>Math.random()-0.5);const cont=document.getElementById('c22-opts');cont.innerHTML='';
  a.forEach(v=>{const b=document.createElement('button');b.className='ec-mc-btn';b.textContent=v;b.onclick=()=>{if(v===S.c22answer)goNext();else fail(`不正解 / ${S.c22answer}`);};cont.appendChild(b);});
}

// ══ C23 FLASH SEQUENCE ══
function initC23(){
  const seqLen=4+~~(Math.random()*3);const cells=16;S.c23seq=[];while(S.c23seq.length<seqLen){const p=~~(Math.random()*cells);if(!S.c23seq.includes(p))S.c23seq.push(p);}
  S.c23input=[];S.c23phase='show';
  document.getElementById('c23-phase').textContent='光った位置を順番に記憶してください';document.getElementById('c23-prog').textContent='—';
  const g=document.getElementById('c23-grid');g.innerHTML='';
  for(let i=0;i<cells;i++){const c=document.createElement('div');c.className='ec-mem-cell off';c.dataset.i=i;g.appendChild(c);}
  S.c23timers=[];let delay=500;S.c23seq.forEach((pos,j)=>{
    const _t=setTimeout(()=>{const c=g.querySelector(`[data-i="${pos}"]`);if(!c)return;c.className='ec-mem-cell on';const _t2=setTimeout(()=>{if(c)c.classList.remove('on'),c.classList.add('off');},400);S.c23timers.push(_t2);},delay);S.c23timers.push(_t);delay+=700;
  });
  const _tIn=setTimeout(()=>{
    S.c23phase='input';document.getElementById('c23-phase').textContent='順番にタップしてください';
    g.querySelectorAll('.ec-mem-cell').forEach(c=>{c.className='ec-mem-cell off inp';c.onclick=()=>{
      if(S.c23phase!=='input'||c.dataset.clicked||!c.isConnected)return;c.dataset.clicked='1';const pos=+c.dataset.i;S.c23input.push(pos);c.classList.add('on');c.classList.remove('off');setTimeout(()=>{c.classList.remove('on');c.classList.add('off');},300);
      document.getElementById('c23-prog').textContent=`${S.c23input.length}/${S.c23seq.length}`;
      const idx=S.c23input.length-1;if(S.c23input[idx]!==S.c23seq[idx]){fail('順番が違います');return;}
      if(S.c23input.length===S.c23seq.length)goNext();
    };});
  },delay+300);
  S.c23timers.push(_tIn);
}

// ══ C24 TWO POINT CLICK ══
function initC24(){
  S.c24step=0;S.c24clickA=null;S.c24clickB=null;
  const cv=document.getElementById('c24-cv');cv.width=cv.clientWidth||480;const W=cv.width,H=210;
  const tA={x:40+~~(Math.random()*(W/2-60)),y:30+~~(Math.random()*(H-60))};
  const tB={x:W/2+20+~~(Math.random()*(W/2-60)),y:30+~~(Math.random()*(H-60))};
  S.c24tA=tA;S.c24tB=tB;drawCoord2(cv,tA,tB,null,null);
  cv.onclick=e=>{
    const r=cv.getBoundingClientRect();const x=(e.clientX-r.left)*(W/r.width),y=(e.clientY-r.top)*(H/r.height);
    if(S.c24step===0){S.c24clickA={x,y};S.c24step=1;drawCoord2(cv,tA,tB,S.c24clickA,null);document.getElementById('c24-hint').textContent='次に青い × をクリック';}
    else if(S.c24step===1){S.c24clickB={x,y};S.c24step=2;drawCoord2(cv,tA,tB,S.c24clickA,S.c24clickB);}
  };
}
function drawCoord2(cv,tA,tB,cA,cB){
  drawCoord(cv,tA.x,tA.y,cA);// reuse drawCoord
  const ctx=cv.getContext('2d');const s=9;ctx.strokeStyle='#0984e3';ctx.lineWidth=2.5;ctx.beginPath();ctx.moveTo(tB.x-s,tB.y-s);ctx.lineTo(tB.x+s,tB.y+s);ctx.stroke();ctx.beginPath();ctx.moveTo(tB.x+s,tB.y-s);ctx.lineTo(tB.x-s,tB.y+s);ctx.stroke();
  if(cB){ctx.beginPath();ctx.arc(cB.x,cB.y,5,0,Math.PI*2);ctx.fillStyle='#0984e3';ctx.fill();}
}
function chkC24(){
  if(!S.c24clickA||!S.c24clickB){setStatus('warn','2つともクリックしてください');return;}
  const dxA=S.c24clickA.x-S.c24tA.x,dyA=S.c24clickA.y-S.c24tA.y;
  const dxB=S.c24clickB.x-S.c24tB.x,dyB=S.c24clickB.y-S.c24tB.y;
  if(Math.sqrt(dxA*dxA+dyA*dyA)<=14&&Math.sqrt(dxB*dxB+dyB*dyB)<=14)goNext();else fail('ずれています (±14px)');
}

// ══ C25 TIME SENSE ══
function initC25(){
  S.c25target=3+~~(Math.random()*7);S.c25startTime=0;S.c25running=false;
  document.getElementById('c25-target-label').textContent=S.c25target;
  const btn=document.getElementById('c25-btn');btn.disabled=true;btn.textContent='START';btn.style.background='var(--green)';
  btn.onclick=()=>{
    if(!S.c25running){S.c25running=true;S.c25startTime=Date.now();btn.textContent='NOW';btn.style.background='var(--ink)';}
    else{chkC25();}
  };setTimeout(()=>btn.disabled=false,200);
}
function chkC25(){
  const elapsed=(Date.now()-S.c25startTime)/1000;const diff=Math.abs(elapsed-S.c25target);
  if(diff<=0.8)goNext();else fail(`${elapsed.toFixed(2)}秒 — 目標${S.c25target}秒 (±0.8)`);
}

// ══ C26 PATTERN FILL ══
function initC26(){
  const patterns=[
    {q:'1, 4, 9, 16, _',ans:'25',opts:['20','25','30','36']},
    {q:'A, C, E, G, _',ans:'I',opts:['H','I','J','K']},
    {q:'2, 6, 18, 54, _',ans:'162',opts:['108','162','216','324']},
    {q:'○△□○△□○△_',ans:'□',opts:['○','△','□','×']},
    {q:'Z, Y, X, W, _',ans:'V',opts:['U','V','W','X']},
    {q:'1, 1, 2, 3, 5, 8, _',ans:'13',opts:['11','12','13','14']},
    {q:'月, 火, 水, 木, _',ans:'金',opts:['土','日','金','木']},
  ];
  const p=patterns[~~(Math.random()*patterns.length)];S.c26answer=p.ans;
  document.getElementById('c26-pattern').textContent=p.q;
  const cont=document.getElementById('c26-opts');cont.innerHTML='';
  p.opts.sort(()=>Math.random()-0.5).forEach(o=>{const b=document.createElement('button');b.className='ec-mc-btn';b.textContent=o;b.onclick=()=>{if(o===S.c26answer)goNext();else fail(`不正解 / ${S.c26answer}`);};cont.appendChild(b);});
}

// ══ C27 SHELL GAME — DOM sliding cards ══
function clearC27(){if(S.c27timers){S.c27timers.forEach(t=>clearTimeout(t));S.c27timers=[];}}

function initC27(){
  clearC27();S.c27timers=[];S.c27phase='show';

  // S.c27slots[slotIndex] = cardId (0=red, 1=dark, 2=dark)
  S.c27slots=[0,1,2];
  const initRedSlot=~~(Math.random()*3);
  [S.c27slots[0],S.c27slots[initRedSlot]]=[S.c27slots[initRedSlot],S.c27slots[0]];

  const arena=document.getElementById('c27-arena');
  arena.innerHTML='';
  const btns=document.getElementById('c27-btns');btns.innerHTML='';
  document.getElementById('c27-hint').textContent='赤いカードの位置を覚えてください';

  const arenaW=arena.offsetWidth||460;
  const CARD_W=90,CARD_GAP=(arenaW-CARD_W*3)/4;
  const slotX=si=>CARD_GAP+si*(CARD_W+CARD_GAP);
  const CARD_COLORS=['#d63031','#2d2a3e','#2d2a3e'];
  const CARD_LABELS=['①','②','③'];

  // Create one DOM element per card (not per slot)
  const cardEls=[];
  for(let cid=0;cid<3;cid++){
    const el=document.createElement('div');
    el.className='shell-card';
    el.style.background=CARD_COLORS[cid];
    el.textContent=CARD_LABELS[cid];
    el.style.left=slotX(S.c27slots.indexOf(cid))+'px';
    el.dataset.cid=cid;
    el.style.animation=`cardReveal 0.45s cubic-bezier(0.175,0.885,0.32,1.15) ${cid*90}ms both`;
    arena.appendChild(el);
    cardEls.push(el);
  }
  S.c27cardEls=cardEls;

  // Render current slot state with smooth CSS transition
  function renderSlots(){
    for(let cid=0;cid<3;cid++){
      cardEls[cid].style.left=slotX(S.c27slots.indexOf(cid))+'px';
    }
  }

  // Build swap sequence (guaranteed all 3 slots participate)
  const moves=7+~~(Math.random()*5);
  const swapSeq=[];
  for(let m=0;m<moves;m++){
    let a=~~(Math.random()*3),b;
    do{b=~~(Math.random()*3);}while(b===a);
    swapSeq.push([a,b]);
  }

  // Each swap: lift one card, slide both, drop
  const SWAP_MS=420;
  let delay=1400;

  swapSeq.forEach(([sa,sb],mi)=>{
    const tLift=setTimeout(()=>{
      if(S.c27phase==='done')return;
      const _h27=document.getElementById('c27-hint');if(_h27&&_h27.isConnected)_h27.textContent=`シャッフル中... ${mi+1}/${moves}`;
      const cidA=S.c27slots[sa];
      const cidB=S.c27slots[sb];
      // Arc: lift A over B
      cardEls[cidA].style.transition='left '+SWAP_MS*0.55+'ms cubic-bezier(0.4,0,0.2,1),top 0.18s ease,transform 0.18s cubic-bezier(0.4,0,0.2,1),z-index 0s';
      cardEls[cidA].style.zIndex='10';
      cardEls[cidA].style.transform='translateY(calc(-50% - 28px)) scale(1.06)';

      const tMid=setTimeout(()=>{
        if(S.c27phase==='done')return;
        [S.c27slots[sa],S.c27slots[sb]]=[S.c27slots[sb],S.c27slots[sa]];
        // Slide B across at the same time
        cardEls[cidB].style.transition='left '+SWAP_MS*0.6+'ms cubic-bezier(0.4,0,0.2,1)';
        renderSlots();
        // Move A to its new position (still lifted)
        cardEls[cidA].style.left=slotX(S.c27slots.indexOf(cidA))+'px';
      },SWAP_MS*0.2);

      const tDrop=setTimeout(()=>{
        if(S.c27phase==='done')return;
        cardEls[cidA].style.transform='translateY(-50%)';
        cardEls[cidA].style.zIndex='';
      },SWAP_MS*0.7);

      S.c27timers.push(tMid,tDrop);
    },delay);
    S.c27timers.push(tLift);
    delay+=SWAP_MS+80;
  });

  // Hide red color, show choose UI
  const tHide=setTimeout(()=>{
    if(S.c27phase==='done')return;
    cardEls.forEach(el=>{
      el.style.background='#1a1825';
      el.style.transition='background 0.4s ease,left 0.38s cubic-bezier(0.4,0,0.2,1),transform 0.18s ease';
    });
    document.getElementById('c27-hint').textContent='どのカードが赤でしたか？';
  },delay);
  S.c27timers.push(tHide);

  const tChoose=setTimeout(()=>{
    if(S.c27phase==='done')return;
    S.c27phase='choose';
    const redSlot=S.c27slots.indexOf(0);

    function choose(cid){
      if(S.c27phase!=='choose')return;
      S.c27phase='done';
      const correct=(S.c27slots.indexOf(cid)===redSlot);
      if(correct){
        cardEls[cid].style.background='#00b894';
        cardEls[cid].style.animation='cardRight 0.45s cubic-bezier(0.175,0.885,0.32,1.4)';
        // Reveal number label on all
        setTimeout(()=>goNext(),450);
      } else {
        cardEls[cid].style.animation='cardWrong 0.5s ease';
        cardEls[0].style.background='#d63031'; // reveal red
        setTimeout(()=>fail('外れ！'),520);
      }
    }

    // Make cards directly clickable
    cardEls.forEach((el,cid)=>{
      el.classList.add('clickable');
      el.onclick=()=>choose(cid);
    });

    // Also show numbered buttons below
    for(let i=0;i<3;i++){
      const ii=i;
      const b=document.createElement('button');
      b.className='ec-btn';b.style.flex='1';
      b.textContent=`${CARD_LABELS[ii]} を選ぶ`;
      b.onclick=()=>choose(ii);
      btns.appendChild(b);
    }
  },delay+380);
  S.c27timers.push(tChoose);
}
// ══ C28 MIRROR ══
function initC28(){
  S.c28sel=-1;S.c28correct=-1;
  const shapes2=Array.from({length:3},()=>({type:SHAPES[~~(Math.random()*SHAPES.length)],x:20+~~(Math.random()*80),y:20+~~(Math.random()*80),r:10+~~(Math.random()*15),rot:(Math.random()-.5)*Math.PI}));
  const wrap=document.getElementById('c28-wrap');wrap.innerHTML='';
  // target
  const tw=120,th=120;const td=document.createElement('div');td.style.cssText='display:inline-block;border:1px solid var(--mid);border-radius:2px;margin-right:12px;vertical-align:top;';
  const tl=document.createElement('div');tl.style.cssText='font-family:var(--mono);font-size:9px;color:var(--dim);text-align:center;padding:4px;';tl.textContent='元';
  const tcv=document.createElement('canvas');tcv.width=tw;tcv.height=th;tcv.style.cssText='display:block;';
  td.appendChild(tl);td.appendChild(tcv);wrap.appendChild(td);
  drawMirrorCv(tcv,shapes2,false,tw,th);
  // options: correct=hflip, wrong=vflip, wrong=scramble
  const opts=[
    {shapes:shapes2,flip:true},
    {shapes:shapes2.map(s=>({...s,y:th-s.y})),flip:false},
    {shapes:shapes2.map(s=>({...s,x:15+~~(Math.random()*90),y:15+~~(Math.random()*90)})),flip:false},
  ].sort(()=>Math.random()-0.5);
  S.c28correct=opts.findIndex(o=>o.flip===true);
  const og=document.createElement('div');og.style.cssText='display:inline-flex;gap:6px;';
  opts.forEach((opt,i)=>{
    const div=document.createElement('div');div.style.cssText='border:2px solid var(--mid);border-radius:2px;cursor:pointer;transition:border-color .1s;';div.setAttribute('data-c28i',i);
    const cv=document.createElement('canvas');cv.width=tw;cv.height=th;cv.style.display='block';div.appendChild(cv);
    div.onclick=()=>{document.querySelectorAll('[data-c28i]').forEach(x=>x.style.borderColor='var(--mid)');div.style.borderColor='var(--ink)';S.c28sel=i;};
    og.appendChild(div);drawMirrorCv(cv,opt.shapes,opt.flip,tw,th);
  });
  wrap.appendChild(og);
  const btn=document.createElement('button');btn.className='ec-btn';btn.style.marginTop='10px';btn.textContent='VERIFY';btn.onclick=()=>{if(S.c28sel<0){setStatus('warn','選んでください');return;}if(S.c28sel===S.c28correct)goNext();else fail('鏡像が一致しません');};wrap.appendChild(document.createElement('br'));wrap.appendChild(btn);
}
function drawMirrorCv(cv,shapes,flip,W,H){
  const ctx=cv.getContext('2d');ctx.fillStyle='#f5f2ed';ctx.fillRect(0,0,W,H);
  shapes.forEach(({type,x,y,r,rot})=>drawShape(ctx,type,flip?W-x:x,y,r,'#1a1825',flip?-rot:rot));
}

// ══ C29 SPAM TAP ══
function initC29(){
  S.c29target=15+~~(Math.random()*20);S.c29count=0;S.c29over=false;
  document.getElementById('c29-count').textContent='0';document.getElementById('c29-target-label').textContent=`目標: ぴったり ${S.c29target} 回`;
}
function tapC29(e){
  if(S.c29over)return;S.c29count++;document.getElementById('c29-count').textContent=S.c29count;
  const tapEl=document.getElementById('c29-tap');if(e&&tapEl)addRipple(tapEl,e);
  if(S.c29count>S.c29target){
    S.c29over=true;
    if(tapEl){tapEl.style.opacity='0.3';tapEl.style.pointerEvents='none';}
    fail(`${S.c29count}回 — オーバー！`);
  }
}
function chkC29(){if(S.c29over)return;if(S.c29count===S.c29target)goNext();else fail(`${S.c29count}回 — 目標は${S.c29target}回`);}

// ══ C30 DELAYED CLICK ══
function initC30(){
  S.c30target=2+~~(Math.random()*4);S.c30startTime=0;S.c30started=false;
  const btn=document.getElementById('c30-click-btn');btn.disabled=true;
  const cv=document.getElementById('c30-cv');cv.width=cv.clientWidth||460;const W=cv.width,H=60;
  const ctx=cv.getContext('2d');ctx.fillStyle='#f5f2ed';ctx.fillRect(0,0,W,H);ctx.fillStyle='var(--dim)';ctx.font='12px IBM Plex Mono,monospace';ctx.textAlign='center';ctx.textBaseline='middle';ctx.fillText('待機中... 赤い円が現れたら計測開始',W/2,H/2);
  document.getElementById('c30-sub').textContent=`${S.c30target} 秒後にボタンを押してください (±0.6s)`;
  S.c30t=setTimeout(()=>{
    S.c30t=null;S.c30startTime=Date.now();S.c30started=true;btn.disabled=false;
    const W2=cv.width;ctx.fillStyle='#f5f2ed';ctx.fillRect(0,0,W2,H);ctx.fillStyle='#d63031';ctx.beginPath();ctx.arc(W2/2,H/2,18,0,Math.PI*2);ctx.fill();
    ctx.fillStyle='white';ctx.fillText('START',W2/2,H/2);
  },1500+~~(Math.random()*1500));
}
function chkC30(){
  if(!S.c30started){setStatus('warn','まだ赤い円が現れていません');return;}
  const elapsed=(Date.now()-S.c30startTime)/1000;const diff=Math.abs(elapsed-S.c30target);
  if(diff<=0.6)goNext();else fail(`${elapsed.toFixed(2)}秒 — 目標${S.c30target}秒 (±0.6)`);
}

// ══ C31 HEX MATH ══
function initC31(){
  const n=16+~~(Math.random()*239);S.c31answer=n;
  document.getElementById('c31-hex').textContent='0x'+n.toString(16).toUpperCase().padStart(2,'0');
  const opts=new Set([n]);while(opts.size<4){const v=16+~~(Math.random()*239);if(Math.abs(v-n)>3)opts.add(v);}
  const arr=[...opts].sort(()=>Math.random()-0.5);const cont=document.getElementById('c31-opts');cont.innerHTML='';
  arr.forEach(v=>{const b=document.createElement('button');b.className='ec-mc-btn';b.textContent=v;b.onclick=()=>{if(v===S.c31answer)goNext();else fail(`不正解 / ${S.c31answer}`);};cont.appendChild(b);});
}

// ══ C32 MEMORY SORT ══
function initC32(){
  if(S.c32t){clearTimeout(S.c32t);S.c32t=null;}
  const nums=Array.from({length:5},()=>1+~~(Math.random()*99)).sort(()=>Math.random()-0.5);
  S.c32nums=nums;S.c32answer=[...nums].sort((a,b)=>a-b);S.c32slots=Array(5).fill(null);S.c32phase='show';
  document.getElementById('c32-phase').textContent='3秒間記憶してください';document.getElementById('c32-btn').style.display='none';
  document.getElementById('c32-slots').innerHTML='';document.getElementById('c32-items').innerHTML='';
  const cv=document.getElementById('c32-cv');cv.width=cv.clientWidth||460;const W=cv.width,H=68;
  const ctx=cv.getContext('2d');ctx.fillStyle='#f5f2ed';ctx.fillRect(0,0,W,H);
  ctx.font='bold 24px IBM Plex Mono,monospace';ctx.textAlign='center';ctx.textBaseline='middle';ctx.fillStyle='#1a1825';
  const step=W/(nums.length+1);nums.forEach((n,i)=>ctx.fillText(n,(i+1)*step,H/2));
  S.c32t=setTimeout(()=>{
    S.c32t=null;if(S.c32phase!=='show')return;
    const _p32=document.getElementById('c32-phase');if(!_p32||!_p32.isConnected)return;
    S.c32phase='sort';
    const off=document.createElement('canvas');off.width=W;off.height=H;const oc=off.getContext('2d');oc.fillStyle='#f5f2ed';oc.fillRect(0,0,W,H);oc.save();oc.filter='blur(9px)';oc.font='bold 24px IBM Plex Mono,monospace';oc.textAlign='center';oc.textBaseline='middle';oc.fillStyle='rgba(0,0,0,.55)';nums.forEach((n,i)=>oc.fillText(n,(i+1)*step,H/2));oc.restore();ctx.putImageData(oc.getImageData(0,0,W,H),0,0);for(let i=0;i<600;i++){ctx.fillStyle=`rgba(245,242,237,${.3+Math.random()*.5})`;ctx.fillRect(Math.random()*W,Math.random()*H,1+Math.random()*3,1+Math.random()*3);}S.c32nums=null;
    document.getElementById('c32-phase').textContent='昇順に並べてください';document.getElementById('c32-btn').style.display='block';
    const sl=document.getElementById('c32-slots');for(let i=0;i<5;i++){const s=document.createElement('div');s.className='ec-sort-slot';s.dataset.i=i;s.textContent=i+1;sl.appendChild(s);}
    const it=document.getElementById('c32-items');const shuffled=[...nums].sort(()=>Math.random()-0.5);
    shuffled.forEach(n=>{const el=document.createElement('div');el.className='ec-sort-num';el.textContent=n;el.onclick=()=>{if(el.classList.contains('used'))return;const si=S.c32slots.findIndex(v=>v===null);if(si<0)return;S.c32slots[si]=n;el.classList.add('used');const slot=document.querySelector(`.ec-sort-slot[data-i="${si}"]`);if(slot){slot.textContent=n;slot.classList.add('filled');}};it.appendChild(el);});
  },3000);
}
function chkC32(){
  if(S.c32slots.includes(null)){setStatus('warn','すべて選んでください');return;}
  if(S.c32slots.every((v,i)=>v===S.c32answer[i]))goNext();else fail('順番が違います');
}

// ══ C33 DEDUCTIVE LOGIC ══
const LOGIC2=[
  {q:'① すべてのAはBである\n② すべてのBはCである\nならば、すべてのAはCである？',ans:'Yes',opts:['Yes','No','わからない','どちらでもない']},
  {q:'① 今日は月曜か火曜のどちらかだ\n② 今日は月曜ではない\n結論: 今日は火曜だ',ans:'正しい',opts:['正しい','誤り','判断不能','条件が矛盾']},
  {q:'① AまたはBが真\n② Aが偽\n③ BまたはCが偽\nCは真か？',ans:'真',opts:['真','偽','不明','矛盾']},
  {q:'3人 A,B,C がいる。\n正直者は真実のみ、嘘つきは嘘のみを言う。\nA「私は嘘つきだ」\nAは正直者か？',ans:'嘘つき',opts:['正直者','嘘つき','どちらでもない','矛盾']},
];
function initC33(){
  const q=LOGIC2[~~(Math.random()*LOGIC2.length)];S.c33answer=q.ans;
  document.getElementById('c33-logic').textContent=q.q;const cont=document.getElementById('c33-opts');cont.innerHTML='';
  q.opts.sort(()=>Math.random()-0.5).forEach(o=>{const b=document.createElement('button');b.className='ec-mc-btn';b.textContent=o;b.onclick=()=>{if(o===S.c33answer)goNext();else fail(`不正解 / ${S.c33answer}`);};cont.appendChild(b);});
}

// ══ C34 TRIPLE SLIDER ══
function initC34(){
  const am=10+~~(Math.random()*76);S.c34atarget={min:am,max:am+5};S.c34aval=0;
  const bm=10+~~(Math.random()*76);S.c34btarget={min:bm,max:bm+5};S.c34bval=0;
  const cm=10+~~(Math.random()*76);S.c34ctarget={min:cm,max:cm+5};S.c34cval=0;
  ['a','b','c'].forEach(k=>{document.getElementById(`c34${k}-zone`).style.left=S[`c34${k}target`].min+'%';document.getElementById(`c34${k}-zone`).style.width='5%';updSlider3(`c34${k}`,0);mkSlider(`c34${k}-track`,`c34${k}val`,`c34${k}drag`);});
}
function chkC34(){
  const ok=k=>S[`c34${k}val`]>=S[`c34${k}target`].min&&S[`c34${k}val`]<=S[`c34${k}target`].max;
  if(ok('a')&&ok('b')&&ok('c'))goNext();else{const fails=['a','b','c'].filter(k=>!ok(k)).map(k=>k.toUpperCase()).join('・');fail(`${fails} が外れ`);}
}

// ══ C35 MOVING TARGETS ══
function clearC35(){
  S.c35running=false;
  if(S.c35rafId){cancelAnimationFrame(S.c35rafId);S.c35rafId=null;}
  if(S.c35spawnTimers){S.c35spawnTimers.forEach(t=>clearTimeout(t));S.c35spawnTimers=[];}
  S.c35int=null; // keep for legacy compat checks
}
function initC35(){
  clearC35();
  const cv=document.getElementById('c35-cv');
  cv.width=cv.clientWidth||460;
  const W=cv.width,H=220;
  const ctx=cv.getContext('2d');
  ctx.fillStyle='#f5f2ed';ctx.fillRect(0,0,W,H);
  const totalT=6+~~(Math.random()*4);
  S.c35total=totalT;S.c35clicked=0;S.c35targets=[];S.c35spawnTimers=[];S.c35running=true;
  const _r35=document.getElementById('c35-remain');if(_r35)_r35.textContent=`残り ${totalT} / ${totalT}`;

  // Spawn targets progressively
  let spawned=0;
  const spawn=()=>{
    if(!S.c35running||spawned>=totalT)return;
    spawned++;
    const r=22,tx=r+Math.random()*(W-r*2),ty=r+Math.random()*(H-r*2);
    const vx=(Math.random()-.5)*2.0,vy=(Math.random()-.5)*2.0;
    S.c35targets.push({x:tx,y:ty,vx,vy,r,alive:true,born:performance.now()});
    if(spawned<totalT){
      const tid=setTimeout(spawn,500+~~(Math.random()*700));
      S.c35spawnTimers.push(tid);
    }
  };
  spawn();

  cv.onclick=e=>{
    if(!S.c35running)return;
    const rect=cv.getBoundingClientRect();
    const mx=(e.clientX-rect.left)*(W/rect.width),my=(e.clientY-rect.top)*(H/rect.height);
    S.c35targets.forEach(t=>{
      if(!t.alive)return;
      const dx=mx-t.x,dy=my-t.y;
      if(Math.sqrt(dx*dx+dy*dy)<=t.r+4){
        t.alive=false;t.hitTime=performance.now();
        S.c35clicked++;
        const _r35b=document.getElementById('c35-remain');if(_r35b)_r35b.textContent=`残り ${totalT-S.c35clicked} / ${totalT}`;
        if(S.c35clicked===totalT){clearC35();goNext();}
      }
    });
  };

  let lastTime=0;
  const loop=(ts)=>{
    if(!S.c35running)return;
    S.c35rafId=requestAnimationFrame(loop);
    if(ts-lastTime<14)return;
    lastTime=ts;
    ctx.fillStyle='#f5f2ed';ctx.fillRect(0,0,W,H);
    S.c35targets.forEach(t=>{
      if(!t.alive){
        // brief pop-out death flash
        if(t.hitTime&&ts-t.hitTime<200){
          const prog=(ts-t.hitTime)/200;
          ctx.globalAlpha=1-prog;
          ctx.beginPath();ctx.arc(t.x,t.y,t.r*(1+prog*0.5),0,Math.PI*2);
          ctx.fillStyle='#00b894';ctx.fill();
          ctx.globalAlpha=1;
        }
        return;
      }
      t.x+=t.vx;t.y+=t.vy;
      if(t.x<t.r||t.x>W-t.r)t.vx*=-1;
      if(t.y<t.r||t.y>H-t.r)t.vy*=-1;
      // pulse scale based on age
      const age=ts-t.born;
      const pulse=1+Math.sin(age/300)*0.06;
      ctx.save();
      ctx.translate(t.x,t.y);ctx.scale(pulse,pulse);
      ctx.beginPath();ctx.arc(0,0,t.r,0,Math.PI*2);
      ctx.fillStyle='#d63031';ctx.fill();
      ctx.beginPath();ctx.arc(0,0,t.r-4,0,Math.PI*2);
      ctx.fillStyle='rgba(255,255,255,0.15)';ctx.fill();
      ctx.fillStyle='white';ctx.font='bold 13px IBM Plex Mono,monospace';
      ctx.textAlign='center';ctx.textBaseline='middle';ctx.fillText('!',0,0);
      ctx.restore();
    });
  };
  S.c35rafId=requestAnimationFrame(loop);
}

// ══ PARTICLE BURST ══
function burstParticles(){
  const modal=document.querySelector('.ecm');if(!modal)return;
  const rect=modal.getBoundingClientRect();
  const colors=['#00b894','#0984e3','#fdcb6e','#d63031','#6c5ce7','#e17055'];
  for(let i=0;i<28;i++){
    const p=document.createElement('div');p.className='ec-particle';
    const ang=Math.random()*Math.PI*2,spd=60+Math.random()*120;
    const x=rect.left+rect.width/2,y=rect.top+rect.height/2;
    p.style.cssText=`position:fixed;width:${4+Math.random()*6}px;height:${4+Math.random()*6}px;border-radius:${Math.random()>0.5?'50%':'2px'};background:${colors[~~(Math.random()*colors.length)]};left:${x}px;top:${y}px;pointer-events:none;z-index:99999;transform:translate(-50%,-50%);opacity:1;transition:none;`;
    document.body.appendChild(p);
    const tx=Math.cos(ang)*spd,ty=Math.sin(ang)*spd;
    requestAnimationFrame(()=>{
      p.style.transition=`transform ${0.5+Math.random()*0.5}s cubic-bezier(0.25,0.46,0.45,0.94),opacity ${0.4+Math.random()*0.4}s ${0.2+Math.random()*0.3}s ease-out`;
      p.style.transform=`translate(calc(-50% + ${tx}px),calc(-50% + ${ty}px)) rotate(${Math.random()*360}deg) scale(0)`;
      p.style.opacity='0';
    });
    setTimeout(()=>p.remove(),1200);
  }
}

// ══ DOCS TABS ══
function switchTab(id){
  document.querySelectorAll('.docs-tab').forEach(t=>t.classList.remove('active'));
  document.querySelectorAll('.docs-nav-btn').forEach(b=>b.classList.remove('active'));
  document.getElementById('tab-'+id).classList.add('active');
  event.target.classList.add('active');
}

// ══ COPY BUTTONS ══
function copyCode(btn){
  const code=btn.closest('.docs-code-wrap').querySelector('.docs-code');
  // strip HTML tags to get plain text
  const text=code.innerText||code.textContent;
  navigator.clipboard.writeText(text).then(()=>{btn.textContent='COPIED!';btn.classList.add('copied');setTimeout(()=>{btn.textContent='COPY';btn.classList.remove('copied');},2000);});
}
</script>
</body>
</html>